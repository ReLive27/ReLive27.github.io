<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Spring Security和OpenID Connect</title><meta name="robots" content="follow, index"/><meta name="description"/><meta property="og:url" content="/blog/springn-security-oidc"/><meta property="og:type" content="article"/><meta property="og:site_name" content="ReLive27 Blog"/><meta property="og:description"/><meta property="og:title" content="Spring Security和OpenID Connect"/><meta property="og:image" content="/static/images/banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/Twitter"/><meta name="twitter:title" content="Spring Security和OpenID Connect"/><meta name="twitter:description"/><meta name="twitter:image" content="/static/images/banner.png"/><link rel="canonical" href="/blog/springn-security-oidc"/><meta property="article:published_time" content="2022-08-01T20:35:28.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/blog/springn-security-oidc"
  },
  "headline": "Spring Security和OpenID Connect",
  "image": [
    {
      "@type": "ImageObject",
      "url": "/static/images/banner.png"
    }
  ],
  "datePublished": "2022-08-01T20:35:28.000Z",
  "dateModified": "2022-08-01T20:35:28.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "ReLive27"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "ReLive27",
    "logo": {
      "@type": "ImageObject",
      "url": "/static/images/logo.png"
    }
  }
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/0421c3ef5c05976e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0421c3ef5c05976e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-feaf581c327086ac.js" defer=""></script><script src="/_next/static/chunks/main-fff4bba495d1f787.js" defer=""></script><script src="/_next/static/chunks/pages/_app-be0d248eb167f1c7.js" defer=""></script><script src="/_next/static/chunks/675-415f2ef004e9374e.js" defer=""></script><script src="/_next/static/chunks/811-09b059e602669e04.js" defer=""></script><script src="/_next/static/chunks/410-126bb4b3a7c18944.js" defer=""></script><script src="/_next/static/chunks/1-8328c5445f547d8d.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-a331338351da50bc.js" defer=""></script><script src="/_next/static/TGn5Ov6tzxMTY3j5IMXdM/_buildManifest.js" defer=""></script><script src="/_next/static/TGn5Ov6tzxMTY3j5IMXdM/_ssgManifest.js" defer=""></script><script src="/_next/static/TGn5Ov6tzxMTY3j5IMXdM/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="ReLive27" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">ReLive27</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/">Home</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/columns">Column</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/">Home</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/columns">Column</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-08-01T20:35:28.000Z">2022年8月1日星期一</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Spring Security和OpenID Connect</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="../static/images/avatar.png?imwidth=48 1x, ../static/images/avatar.png?imwidth=96 2x" src="../static/images/avatar.png?imwidth=96" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">ReLive27</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="spring-security和openid-connect"><a href="#spring-security和openid-connect" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Spring Security和OpenID Connect</h2><h3 id="概述"><a href="#概述" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>概述</h3><p>OpenID Connect 是一个开放标准，由 OpenID 基金会于 2014 年 2 月发布。它定义了一种使用 OAuth 2.0 执行用户身份认证的互通方式。OpenID Connect 直接基于 OAuth 2.0 构建，并保持与它兼容。</p><p>当授权服务器支持 OIDC 时，它有时被称为<em>身份提供者（Idp）</em>，因为它向<strong>客户端</strong>提供有关<strong>资源所有者</strong>的信息。而<strong>客户端</strong>映射为OpenID Connect 流程中<em>登录依赖方（RP）</em>。在本文中我们将授权服务称为身份提供者，客户端称为登录依赖方进行陈述。</p><p>OpenID Connect 流程看起来与 OAuth 相同。主要区别是，在授权请求中，使用了一个特定的范围<code>openid</code>，而在获取token中，<strong>登录依赖方（RP）<strong>同时接收到一个</strong>访问令牌</strong>和一个<strong>ID 令牌</strong>（经过签名的 JWT）。ID令牌与访问令牌不同的是，ID 令牌是发送给 RP 的，并且要被它解析。</p><p><strong>本文您将学到</strong>：</p><ul><li>配置授权服务支持OpenID Connect</li><li>自定义ID令牌</li><li>登录依赖方通过<code>OAuth2UserService</code>实现权限映射</li></ul><p><strong>先决条件：</strong></p><ul><li>java 8+</li><li>mysql</li></ul><h3 id="使用spring-authorization-server搭建身份提供服务idp"><a href="#使用spring-authorization-server搭建身份提供服务idp" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>使用Spring Authorization Server搭建身份提供服务(IdP)</h3><p>本节中我们将使用<a target="_blank" rel="noopener noreferrer" href="https://spring.io/projects/spring-authorization-server">Spring Authorization Server</a>搭建身份提供服务，并通过<code>OAuth2TokenCustomizer</code>实现自定义ID Token。</p><h4 id="maven-依赖项"><a href="#maven-依赖项" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>maven 依赖项</h4><div class="relative"><pre><code class="code-highlight language-xml"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-oauth2-authorization-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div><h4 id="配置"><a href="#配置" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>配置</h4><p>首先我们配置身份提供服务端口8080:</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">server</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span></code></pre></div><p>接下来我们创建<code>AuthorizationServerConfig</code>配置类，在此类中我们配置OAuth2及OICD相关Bean。我们首先注册一个客户端：</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">RegisteredClientRepository</span> <span class="token function">registeredClientRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">RegisteredClient</span> registeredClient <span class="token operator">=</span> <span class="token class-name">RegisteredClient</span><span class="token punctuation">.</span><span class="token function">withId</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">clientId</span><span class="token punctuation">(</span><span class="token string">&quot;relive-client&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">clientSecret</span><span class="token punctuation">(</span><span class="token string">&quot;{noop}relive-client&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">clientAuthenticationMethods</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ClientAuthenticationMethod</span><span class="token punctuation">.</span><span class="token constant">CLIENT_SECRET_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                    s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ClientAuthenticationMethod</span><span class="token punctuation">.</span><span class="token constant">CLIENT_SECRET_BASIC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">authorizationGrantType</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationGrantType</span><span class="token punctuation">.</span><span class="token constant">AUTHORIZATION_CODE</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">authorizationGrantType</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationGrantType</span><span class="token punctuation">.</span><span class="token constant">REFRESH_TOKEN</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">redirectUri</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8070/login/oauth2/code/messaging-client-oidc&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token class-name">OidcScopes</span><span class="token punctuation">.</span><span class="token constant">OPENID</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token class-name">OidcScopes</span><span class="token punctuation">.</span><span class="token constant">PROFILE</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token class-name">OidcScopes</span><span class="token punctuation">.</span><span class="token constant">EMAIL</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">clientSettings</span><span class="token punctuation">(</span><span class="token class-name">ClientSettings</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">requireAuthorizationConsent</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">requireProofKey</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">tokenSettings</span><span class="token punctuation">(</span><span class="token class-name">TokenSettings</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">accessTokenFormat</span><span class="token punctuation">(</span><span class="token class-name">OAuth2TokenFormat</span><span class="token punctuation">.</span><span class="token constant">SELF_CONTAINED</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">idTokenSignatureAlgorithm</span><span class="token punctuation">(</span><span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span><span class="token constant">RS256</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">accessTokenTimeToLive</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">refreshTokenTimeToLive</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">reuseRefreshTokens</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryRegisteredClientRepository</span><span class="token punctuation">(</span>registeredClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><p>我们正在配置的属性是：</p><ul><li>clientId —— Spring Security将使用它来识别哪个客户端正在尝试访问资源</li><li>clientSecret——客户端和服务器都知道的一个秘密，它提供了两者之间的信任</li><li>clientAuthenticationMethod——客户端验证方式，在我们的例子中，我们将支持basic和post身份验证方式</li><li>authorizationGrantType——授权类型，允许客户端生成授权码和刷新令牌</li><li>redirectUri —— 重定向 URI，客户端将在基于重定向的流程中使用它</li><li>scope——此参数定义客户端可能拥有的权限。在我们的例子中，我们将拥有所需的<em>OidcScopes.OPENID</em>和用来获取额外的<em>身份</em>信息<em>OidcScopes.PROFILE</em>，<em>OidcScopes.EMAIL</em>。</li></ul><br/><p>OpenID Connect 使用一个特殊的权限范围值 openid 来控制对 UserInfo 端点的访问。 OpenID Connect 定义了一组标准化的 OAuth 权限范围，对应于用户属性的子集profile、email、 phone、address，参见表格：</p><table><thead><tr><th>权限范围</th><th align="left">声明</th></tr></thead><tbody><tr><td><strong>openid</strong></td><td align="left"><strong>sub</strong></td></tr><tr><td>profile</td><td align="left">Name、family_name、given_name、middle_name、nickname、preferred_username、profile、 picture、website、gender、birthdate、zoneinfo、locale、updated_at</td></tr><tr><td>email</td><td align="left">email、email_verified</td></tr><tr><td>address</td><td align="left">address,是一个 JSON 对象、包含 formatted、street_address、locality、region、postal_code、country</td></tr><tr><td>phone</td><td align="left">phone_number、phone_number_verified</td></tr></tbody></table><p>让我们根据上述规范定义<em>OidcUserInfoService</em>，用于扩展/userinfo用户信息端点响应：</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OidcUserInfoService</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">OidcUserInfo</span> <span class="token function">loadUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> scopes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">OidcUserInfo<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token class-name">OidcUserInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>scopes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>scopes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">OidcScopes</span><span class="token punctuation">.</span><span class="token constant">PROFILE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                builder<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;First Last&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">givenName</span><span class="token punctuation">(</span><span class="token string">&quot;First&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">familyName</span><span class="token punctuation">(</span><span class="token string">&quot;Last&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">middleName</span><span class="token punctuation">(</span><span class="token string">&quot;Middle&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">nickname</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">preferredUsername</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">profile</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8080/&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">picture</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8080/&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">website</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8080/&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">gender</span><span class="token punctuation">(</span><span class="token string">&quot;female&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">birthdate</span><span class="token punctuation">(</span><span class="token string">&quot;2022-05-24&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">zoneinfo</span><span class="token punctuation">(</span><span class="token string">&quot;China/Beijing&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">&quot;zh-cn&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">updatedAt</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token constant">ISO_LOCAL_DATE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>scopes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">OidcScopes</span><span class="token punctuation">.</span><span class="token constant">EMAIL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                builder<span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">&quot;@163.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emailVerified</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>scopes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">OidcScopes</span><span class="token punctuation">.</span><span class="token constant">ADDRESS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token class-name">JSONObject</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                address<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;formatted&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Champ de Mars\n5 Av. Anatole France\n75007 Paris\nFrance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                builder<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>scopes<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">OidcScopes</span><span class="token punctuation">.</span><span class="token constant">PHONE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                builder<span class="token punctuation">.</span><span class="token function">phoneNumber</span><span class="token punctuation">(</span><span class="token string">&quot;13728903134&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">phoneNumberVerified</span><span class="token punctuation">(</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code></pre></div><br/><p>接下来，我们将配置一个 bean 以应用默认 OAuth 安全性。使用上述<em>OidcUserInfoService</em>配置OIDC中UserInfoMapper；oauth2ResourceServer()配置资源服务器使用JWT验证，用来保护Spring Security 提供的/userinfo端点；对于未认证请求我们会将它重定向到/login 登录页：</p><blockquote><p>注意：有时“授权服务器”和“资源服务器”是同一台服务器。</p></blockquote><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token punctuation annotation">@Order</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">authorizationServerSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">OAuth2AuthorizationServerConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpSecurity</span><span class="token punctuation">&gt;</span></span> authorizationServerConfigurer <span class="token operator">=</span>
</span><span class="code-line">                <span class="token keyword">new</span> <span class="token class-name">OAuth2AuthorizationServerConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">//自定义用户映射器</span>
</span><span class="code-line">        <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OidcUserInfoAuthenticationContext</span><span class="token punctuation">,</span> <span class="token class-name">OidcUserInfo</span><span class="token punctuation">&gt;</span></span> userInfoMapper <span class="token operator">=</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">OidcUserInfoAuthenticationToken</span> authentication <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token class-name">JwtAuthenticationToken</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JwtAuthenticationToken</span><span class="token punctuation">)</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">return</span> userInfoService<span class="token punctuation">.</span><span class="token function">loadUser</span><span class="token punctuation">(</span>principal<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">        authorizationServerConfigurer<span class="token punctuation">.</span><span class="token function">oidc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>oidc<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">            oidc<span class="token punctuation">.</span><span class="token function">userInfoEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> userInfo<span class="token punctuation">.</span><span class="token function">userInfoMapper</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">RequestMatcher</span> endpointsMatcher <span class="token operator">=</span> authorizationServerConfigurer<span class="token punctuation">.</span><span class="token function">getEndpointsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">requestMatcher</span><span class="token punctuation">(</span>endpointsMatcher<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>authorizeRequests<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ExpressionUrlAuthorizationConfigurer<span class="token punctuation">.</span>AuthorizedUrl</span><span class="token punctuation">)</span> authorizeRequests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>csrf<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">            csrf<span class="token punctuation">.</span><span class="token function">ignoringRequestMatchers</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestMatcher</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>endpointsMatcher<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>authorizationServerConfigurer<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">oauth2ResourceServer</span><span class="token punctuation">(</span><span class="token class-name">OAuth2ResourceServerConfigurer</span><span class="token operator">::</span><span class="token function">jwt</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exceptions <span class="token operator">-&gt;</span> exceptions<span class="token punctuation">.</span>
</span><span class="code-line">                        <span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginUrlAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>authorizationServerConfigurer<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><br/><p>每个授权服务器都需要其用于令牌的签名密钥，让我们生成一个 2048 字节的 RSA 密钥：</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token punctuation annotation">@Bean</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">JWKSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityContext</span><span class="token punctuation">&gt;</span></span> <span class="token function">jwkSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token class-name">RSAKey</span> rsaKey <span class="token operator">=</span> <span class="token class-name">Jwks</span><span class="token punctuation">.</span><span class="token function">generateRsa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token class-name">JWKSet</span> jwkSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JWKSet</span><span class="token punctuation">(</span>rsaKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>jwkSelector<span class="token punctuation">,</span> securityContext<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> jwkSelector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>jwkSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Jwks</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">private</span> <span class="token class-name">Jwks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RSAKey</span> <span class="token function">generateRsa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token class-name">KeyGeneratorUtils</span><span class="token punctuation">.</span><span class="token function">generateRsaKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">RSAPublicKey</span> publicKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RSAPublicKey</span><span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">RSAPrivateKey</span> privateKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RSAPrivateKey</span><span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RSAKey<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">.</span><span class="token function">privateKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">.</span><span class="token function">keyID</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">KeyGeneratorUtils</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">private</span> <span class="token class-name">KeyGeneratorUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">static</span> <span class="token class-name">KeyPair</span> <span class="token function">generateRsaKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">KeyPair</span> keyPair<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token class-name">KeyPairGenerator</span> keyPairGenerator <span class="token operator">=</span> <span class="token class-name">KeyPairGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;RSA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">return</span> keyPair<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><br/><p>然后我们将使用带有@<em>EnableWebSecurity</em>注释的配置类启用 Spring Web 安全模块：</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token punctuation annotation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation annotation">@EnableWebSecurity</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSecurityConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">SecurityFilterChain</span> <span class="token function">defaultSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">        http
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>authorizeRequests <span class="token operator">-&gt;</span>
</span><span class="code-line">                        authorizeRequests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">//...</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code></pre></div><p>这里我们使用Form表单认证方式，所以我们还需要为登录认证提供用户名和密码：</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">UserDetailsService</span> <span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><br/><p>至此，我们服务配置完成，但是用于给客户端传递权限信息，我们将更改<code>ID Token</code> claim，添加用户角色属性：</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token punctuation annotation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdTokenCustomizerConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">OAuth2TokenCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JwtEncodingContext</span><span class="token punctuation">&gt;</span></span> <span class="token function">tokenCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">OidcParameterNames</span><span class="token punctuation">.</span><span class="token constant">ID_TOKEN</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getTokenType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                context<span class="token punctuation">.</span><span class="token function">getClaims</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">claims</span><span class="token punctuation">(</span>claims <span class="token operator">-&gt;</span>
</span><span class="code-line">                        claims<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                                <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">GrantedAuthority</span><span class="token operator">::</span><span class="token function">getAuthority</span><span class="token punctuation">)</span>
</span><span class="code-line">                                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="登录依赖方服务rp实现"><a href="#登录依赖方服务rp实现" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>登录依赖方服务（RP）实现</h3><p>本节中我们将使用Spring Security搭建登录依赖方服务，并设计相关数据库表结构表达关联身份提供方服务与登录依赖方服务权限关系，通过<code>OAuth2UserService</code>实现权限映射。</p><p>本节中部分代码涉及JPA相关知识，如果您并不了解也没有关系，您可以通过Mybatis进行替换。</p><h4 id="maven-依赖项-1"><a href="#maven-依赖项-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>maven 依赖项</h4><div class="relative"><pre><code class="code-highlight language-xml"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div><h4 id="相关数据库表结构"><a href="#相关数据库表结构" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>相关数据库表结构</h4><p>这是我们本文中RP服务使用的相关数据库表，涉及相关创建表及初始化数据的SQL语句可以<a target="_blank" rel="noopener noreferrer" href="https://github.com/ReLive27/spring-security-oauth2-sample/tree/main/oidc-login/rp/src/main/resources/db/migration">从这里</a>获取。</p><p><img alt="" src="../static/images/blogs/spring-oidc-sql-model.png"/></p><h4 id="配置-1"><a href="#配置-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>配置</h4><p>首先我们通过application.yml文件中配置服务端口和数据库连接信息：</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">server</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">port</span><span class="token punctuation">:</span> <span class="token number">8070</span>
</span><span class="code-line">  <span class="token atrule key">servlet</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">session</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">cookie</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">name</span><span class="token punctuation">:</span> CLIENT<span class="token punctuation">-</span>SESSION
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">spring</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">datasource</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">druid</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">db-type</span><span class="token punctuation">:</span> mysql
</span><span class="code-line">      <span class="token atrule key">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
</span><span class="code-line">      <span class="token atrule key">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/oidc_login<span class="token punctuation">?</span>createDatabaseIfNotExist=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
</span><span class="code-line">      <span class="token atrule key">username</span><span class="token punctuation">:</span> &lt;&lt;root<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> <span class="token comment"># 修改用户名</span>
</span><span class="code-line">      <span class="token atrule key">password</span><span class="token punctuation">:</span> &lt;&lt;password<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> <span class="token comment"># 修改密码</span>
</span></code></pre></div><br/><p>接下来我们将启用Spring Security安全配置。使用Form认证方式；并使用<em>oauth2Login</em>()定义OAuth2登录默认配置：</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">        http<span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>from <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    from<span class="token punctuation">.</span><span class="token function">defaultSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">oauth2Login</span><span class="token punctuation">(</span><span class="token class-name">Customizer</span><span class="token punctuation">.</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><br/><p>下面我们将配置OAuth2客户端基于MySql数据库的存储方式，你也可以从<a target="_blank" rel="noopener noreferrer" href="https://relive27.github.io/blog/persisrence-oauth2-client">Spring Security 持久化OAuth2客户端</a>了解详细信息。</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line">    <span class="token comment doc-comment">/**
</span></span><span class="code-line"><span class="token comment doc-comment">     * 定义JDBC 客户端注册存储库
</span></span><span class="code-line"><span class="token comment doc-comment">     *
</span></span><span class="code-line"><span class="token comment doc-comment">     * <span class="token keyword">@param</span> <span class="token parameter">jdbcTemplate</span>
</span></span><span class="code-line"><span class="token comment doc-comment">     * <span class="token keyword">@return</span>
</span></span><span class="code-line"><span class="token comment doc-comment">     */</span>
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">ClientRegistrationRepository</span> <span class="token function">clientRegistrationRepository</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcClientRegistrationRepository</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment doc-comment">/**
</span></span><span class="code-line"><span class="token comment doc-comment">     * 负责<span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">OAuth2AuthorizedClient</span></span><span class="token punctuation">}</span>在 Web 请求之间进行持久化
</span></span><span class="code-line"><span class="token comment doc-comment">     *
</span></span><span class="code-line"><span class="token comment doc-comment">     * <span class="token keyword">@param</span> <span class="token parameter">jdbcTemplate</span>
</span></span><span class="code-line"><span class="token comment doc-comment">     * <span class="token keyword">@param</span> <span class="token parameter">clientRegistrationRepository</span>
</span></span><span class="code-line"><span class="token comment doc-comment">     * <span class="token keyword">@return</span>
</span></span><span class="code-line"><span class="token comment doc-comment">     */</span>
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">OAuth2AuthorizedClientService</span> <span class="token function">authorizedClientService</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">ClientRegistrationRepository</span> clientRegistrationRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcOAuth2AuthorizedClientService</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">,</span> clientRegistrationRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment doc-comment">/**
</span></span><span class="code-line"><span class="token comment doc-comment">     * OAuth2AuthorizedClientRepository 是一个容器类，用于在请求之间保存和持久化授权客户端
</span></span><span class="code-line"><span class="token comment doc-comment">     *
</span></span><span class="code-line"><span class="token comment doc-comment">     * <span class="token keyword">@param</span> <span class="token parameter">authorizedClientService</span>
</span></span><span class="code-line"><span class="token comment doc-comment">     * <span class="token keyword">@return</span>
</span></span><span class="code-line"><span class="token comment doc-comment">     */</span>
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">OAuth2AuthorizedClientRepository</span> <span class="token function">authorizedClientRepository</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token class-name">OAuth2AuthorizedClientService</span> authorizedClientService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticatedPrincipalOAuth2AuthorizedClientRepository</span><span class="token punctuation">(</span>authorizedClientService<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><br/><p>我们不在使用基于内存的用户名密码，在初始化数据库时我们已经将用户名密码添加到user表中，所以我们需要实现<em>UserDetailsService</em>接口用于Form认证时获取用户信息：</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token punctuation annotation">@RequiredArgsConstructor</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcUserDetailsService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Override</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>relive<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span>User</span> user <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;user is not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;role is not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Role</span><span class="token operator">::</span><span class="token function">getRoleCode</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authorities<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code></pre></div><p>这里<em>UserRepository</em>继承了<em>JpaRepository</em>，提供user表的CRUD，详细代码可以在文末链接中获取。</p><br/><p>现在我们将要解决如何将IdP服务用户角色映射为RP服务已有的角色，在<a target="_blank" rel="noopener noreferrer" href="https://relive27.github.io/blog/oauth2-login">前面文章</a>中曾使用<code>GrantedAuthoritiesMapper</code>映射角色。在本文中我们将使用<em>OAuth2UserService</em>添加角色映射策略，它与<code>GrantedAuthoritiesMapper</code>相比更加灵活:</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OidcRoleMappingUserService</span> <span class="token keyword">implements</span> <span class="token class-name">OAuth2UserService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OidcUserRequest</span><span class="token punctuation">,</span> <span class="token class-name">OidcUser</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token class-name">OidcUserService</span> oidcUserService<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">OAuth2ClientRoleRepository</span> oAuth2ClientRoleRepository<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">//...</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Override</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">OidcUser</span> <span class="token function">loadUser</span><span class="token punctuation">(</span><span class="token class-name">OidcUserRequest</span> userRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">OAuth2AuthenticationException</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">OidcUser</span> oidcUser <span class="token operator">=</span> oidcUserService<span class="token punctuation">.</span><span class="token function">loadUser</span><span class="token punctuation">(</span>userRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">OidcIdToken</span> idToken <span class="token operator">=</span> userRequest<span class="token punctuation">.</span><span class="token function">getIdToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> role <span class="token operator">=</span> idToken<span class="token punctuation">.</span><span class="token function">getClaimAsStringList</span><span class="token punctuation">(</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> mappedAuthorities <span class="token operator">=</span> role<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> oAuth2ClientRoleRepository<span class="token punctuation">.</span><span class="token function">findByClientRegistrationIdAndRoleCode</span><span class="token punctuation">(</span>userRequest<span class="token punctuation">.</span><span class="token function">getClientRegistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegistrationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">OAuth2ClientRole</span><span class="token operator">::</span><span class="token function">getRole</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Role</span><span class="token operator">::</span><span class="token function">getRoleCode</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        oidcUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultOidcUser</span><span class="token punctuation">(</span>mappedAuthorities<span class="token punctuation">,</span> oidcUser<span class="token punctuation">.</span><span class="token function">getIdToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> oidcUser<span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">return</span> oidcUser<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code></pre></div><p>最后我们将创建HomeController，通过控制页面中展示内容使测试效果视觉上更加显著，我们将根据角色展示不同信息，使用<a target="_blank" rel="noopener noreferrer" href="https://www.thymeleaf.org/">thymeleaf</a>模版引擎渲染。</p><div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token punctuation annotation">@Controller</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> articles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token punctuation">{</span>
</span><span class="code-line">        articles<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ROLE_OPERATION&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;Java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        articles<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ROLE_SYSTEM&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;Java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C++&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/home&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">String</span> authority <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;articles&quot;</span><span class="token punctuation">,</span> articles<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>authority<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code></pre></div><p>完成配置后，我们可以访问 <a target="_blank" rel="noopener noreferrer" href="http://127.0.0.1:8070/login">http://127.0.0.1:8070/login</a> 进行测试。</p><h3 id="结论"><a href="#结论" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>结论</h3><p>在本文中分享了Spring Security对于OpenID Connect的支持。与往常一样，本文中使用的源代码可<a target="_blank" rel="noopener noreferrer" href="https://github.com/ReLive27/spring-security-oauth2-sample/tree/main/oidc-login">在 GitHub 上</a>获得。</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=%2Fblog%2Fspringn-security-oidc">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/ReLive27/relive27.com/blob/master/data/blog/springn-security-oidc.md">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/oauth2">OAuth2</a><a class="mr-3 text-sm font-medium text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/springsecurity">SpringSecurity</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/oauth2-login">Spring Security OAuth2登录</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/spring-gateway-oauth2">将Spring Cloud Gateway 与OAuth2模式一起使用</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:re_live27@163.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/ReLive27"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/4051073081555869"><span class="sr-only">juejin</span><svg class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M465.189 161.792c-22.967 18.14-44.325 35.109-47.397 37.742l-5.851 4.68 10.971 8.632c5.998 4.827 11.85 9.508 13.02 10.532 1.17 1.024 17.993 14.336 37.156 29.696l34.962 27.795 5.267-3.95c2.925-2.194 23.259-18.432 45.348-35.986 21.943-17.555 41.253-32.768 42.716-33.646 1.609-1.024 2.779-2.194 2.779-2.78 0-.438-9.655-8.63-21.504-17.846-11.995-9.363-22.674-17.847-23.845-18.871-15.945-13.02-49.737-39.059-50.76-39.059-.586.147-19.896 14.922-42.862 33.061zm233.325 180.37C507.465 493.275 508.928 492.105 505.417 489.911c-3.072-1.902-11.556-8.485-64.073-50.03-9.07-7.168-18.578-14.775-21.358-16.823-2.78-2.194-8.777-6.875-13.312-10.532-4.68-3.657-10.679-8.339-13.312-10.533-13.165-10.24-71.095-56.027-102.107-80.457-5.852-4.681-11.41-8.485-12.142-8.485-.731 0-10.971 7.754-22.674 17.116-11.703 9.508-22.674 18.286-24.284 19.456-1.755 1.17-5.12 3.95-7.46 6.144-2.34 2.34-4.828 4.096-5.413 4.096-3.072 0-.731 3.072 6.437 8.777 4.096 3.218 8.777 6.875 10.094 8.046 1.316 1.024 10.24 8.045 19.748 15.506s23.26 18.286 30.428 23.99c19.31 15.215 31.89 25.308 127.853 101.084 47.836 37.742 88.796 69.779 90.844 71.095 3.657 2.487 3.95 2.487 7.46-.292a1041.42 1041.42 0 0 0 16.092-12.727c6.875-5.413 14.775-11.703 17.554-13.897 30.135-23.699 80.018-63.05 81.774-64.512 1.17-1.024 12.434-9.802 24.868-19.603s37.888-29.696 56.32-44.324c18.579-14.629 46.227-36.425 61.733-48.567 15.506-12.142 27.794-22.528 27.502-23.26-.878-1.17-57.637-47.104-59.978-48.274-.731-.439-18.578 12.727-39.497 29.257z"></path><path d="M57.93 489.326c-15.215 12.288-28.527 23.405-29.697 24.576-2.34 2.194-5.412-.44 80.018 66.852 33.207 26.185 32.622 25.747 57.637 45.495 10.386 8.192 36.279 28.672 57.783 45.495 38.18 30.135 44.91 35.401 52.663 41.545 2.048 1.756 22.967 18.14 46.372 36.572 23.26 18.432 74.167 58.514 112.933 89.088 38.912 30.573 71.095 55.734 71.826 56.027.732.293 7.46-4.389 14.921-10.386 21.797-16.97 90.259-70.949 101.523-79.872 5.705-4.535 12.873-10.24 15.945-12.58 3.072-2.488 6.436-5.12 7.314-5.852.878-.878 11.85-9.509 24.283-19.31 20.773-16.091 59.1-46.226 64.366-50.615 1.17-1.024 5.12-4.096 8.777-6.875 3.657-2.78 7.9-6.29 9.509-7.607 1.609-1.317 14.775-11.703 29.257-23.113 29.11-22.82 42.277-33.207 88.503-69.632 17.262-13.605 32.475-25.454 33.646-26.478 2.486-2.048 31.451-24.869 44.617-35.255 4.827-3.657 9.07-7.168 9.508-7.607.44-.585 5.998-4.827 12.435-9.8 6.436-4.828 13.165-10.24 15.067-11.85l3.365-2.926-9.948-7.753c-5.412-4.388-10.24-8.192-10.679-8.63-1.17-1.317-22.381-18.433-30.135-24.284-3.95-3.072-7.314-5.998-7.606-6.73-1.317-3.071-6.73.147-29.258 17.994-13.458 10.532-25.746 20.187-27.355 21.504-1.61 1.463-10.533 8.338-19.749 15.652-9.216 7.168-17.115 13.459-17.554 13.898-.439.438-6.583 5.412-13.897 10.971-7.168 5.559-15.214 11.703-17.7 13.75-4.974 4.097-5.413 4.39-20.334 16.239-5.56 4.388-11.264 8.777-12.435 9.8-1.17 1.025-20.333 16.092-42.422 33.354-22.09 17.408-41.546 32.768-43.155 34.084-1.609 1.463-14.482 11.557-28.525 22.528s-40.814 32.037-59.539 46.812c-18.578 14.775-42.276 33.353-52.516 41.399s-23.26 18.285-28.965 22.82l-10.386 8.339-4.389-3.072c-2.34-1.756-4.68-3.511-5.12-3.95-.439-.439-4.973-4.096-10.24-8.046-11.849-9.216-14.482-11.264-16.676-13.166-.878-.877-4.243-3.51-7.46-5.851-3.22-2.487-6.145-4.681-6.584-5.12-.439-.439-6.875-5.705-14.482-11.703-7.607-5.851-14.921-11.556-16.091-12.58-1.317-1.17-17.116-13.605-35.255-27.795-17.993-14.19-35.109-27.648-38.035-29.842-5.705-4.681-33.499-26.624-125.074-98.743-34.523-27.209-72.704-57.344-84.846-66.852-49.737-39.498-55.15-43.594-56.905-43.447-.877 0-14.043 10.24-29.257 22.528z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://blog.csdn.net/new_ord?spm=1000.2115.3001.5343"><span class="sr-only">csdn</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M13.36 13.974c.138.03.32.059.678.059 1.435 0 2.447-.779 2.548-1.874.148-1.583-.75-2.137-2.262-2.127-.196 0-.468 0-.612.029l-.352 3.913z" opacity="0.3"></path><path d="M6.217 13.408c.447.18 1.379.359 2.132.359.812 0 1.264-.247 1.3-.632.033-.35-.299-.398-1.216-.637-1.267-.342-2.075-.871-1.996-1.717.092-.982 1.286-1.724 3.118-1.724.893 0 1.759.069 2.208.231l-.154 1.238c-.291-.112-1.406-.266-2.16-.266-.765 0-1.16.265-1.188.555-.034.367.363.385 1.356.676 1.345.376 1.933.905 1.856 1.725-.091.964-1.165 1.784-3.31 1.784-.893 0-1.663-.179-2.087-.359l.141-1.233zM18.821 9.366c4.884-1.017 5.305.811 5.154 2.428l-.284 2.992h-1.55l.259-2.729c.056-.601.405-1.776-1.281-1.732-.584.016-.873.104-.873.104s-.051.726-.112 1.263l-.294 3.095h-1.52l.302-3.05.199-2.371zM12.653 9.224c.349-.042.884-.084 1.621-.084 1.23 0 2.225.236 2.841.734.553.464.921 1.214.819 2.302-.094 1.012-.57 1.721-1.264 2.159-.635.413-1.434.59-2.637.59-.709 0-1.385-.042-1.9-.126l.52-5.575zm1.016 4.466a2.6 2.6 0 0 0 .582.051c1.231 0 2.098-.668 2.185-1.607.127-1.358-.643-1.832-1.94-1.824-.168 0-.401 0-.525.025l-.302 3.355zM5.335 14.813c-.292.111-.896.187-1.74.187-2.427 0-3.737-1.254-3.583-2.913C.198 10.112 2.139 9 4.264 9c.823 0 1.308.073 1.762.195l-.146 1.331c-.302-.112-1.01-.215-1.583-.215-1.25 0-2.312.41-2.434 1.707-.109 1.16.637 1.714 2.044 1.714.49 0 1.212-.077 1.545-.189l-.117 1.27z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://blog.csdn.net/new_ord?spm=1000.2115.3001.5343"><span class="sr-only">jianshu</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M6 1c0 1.082-.693 3.753-4 5v2a9.54 9.54 0 0 0 2.146-.793C4.79 8.127 5 9.434 5 10h2c0-.835-.411-1.982-1-3H4.525A6.952 6.952 0 0 0 6.73 5h.476C7.67 5.732 8 6.653 8 7h2c0-.568-.2-1.282-.508-2H12V3H7.687C7.905 2.27 8 1.573 8 1H6zm10 0c0 1.082-.693 3.753-4 5v2c2.36-.572 3.831-1.725 4.729-3h.476c.465.732.795 1.653.795 2h2c0-.568-.2-1.282-.508-2H22V3h-4.313c.218-.73.313-1.427.313-2h-2zm-4 7H8v2h10v9c0 .565-.435 1-1 1h-2v2h2c1.645 0 3-1.355 3-3V8h-8zm-8 3v11h2V11H4zm4 1v8h5c1.645 0 3-1.355 3-3v-5H8zm2 2h4v1h-4v-1zm0 3h4c0 .565-.435 1-1 1h-3v-1z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>© 2022</div><div> • </div><a href="/">ReLive27</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var t=Object.defineProperty;var r=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var l=e=\u003et(e,\"__esModule\",{value:!0});var h=(e,s)=\u003e()=\u003e(s||e((s={exports:{}}).exports,s),s.exports),N=(e,s)=\u003e{l(e);for(var c in s)t(e,c,{get:s[c],enumerable:!0})},k=(e,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let a of d(s))!m.call(e,a)\u0026\u0026a!==\"default\"\u0026\u0026t(e,a,{get:()=\u003es[a],enumerable:!(c=r(s,a))||c.enumerable});return e},g=e=\u003ek(l(t(e!=null?p(u(e)):{},\"default\",e\u0026\u0026e.__esModule\u0026\u0026\"default\"in e?{get:()=\u003ee.default,enumerable:!0}:{value:e,enumerable:!0})),e);var o=h((I,i)=\u003e{i.exports=_jsx_runtime});var S={};N(S,{default:()=\u003ew,frontmatter:()=\u003ef});var n=g(o()),f={title:\"Spring Security\\u548COpenID Connect\",date:new Date(1659386128e3),tags:[\"OAuth2\",\"SpringSecurity\"],draft:!1,authors:[\"default\"]};function y(e={}){let{wrapper:s}=e.components||{};return s?(0,n.jsx)(s,Object.assign({},e,{children:(0,n.jsx)(c,{})})):c();function c(){let a=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",h3:\"h3\",p:\"p\",em:\"em\",strong:\"strong\",code:\"code\",ul:\"ul\",li:\"li\",h4:\"h4\",pre:\"pre\",table:\"table\",thead:\"thead\",tr:\"tr\",th:\"th\",tbody:\"tbody\",td:\"td\",blockquote:\"blockquote\",img:\"img\"},e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a.h2,{id:\"spring-security\\u548Copenid-connect\",children:[(0,n.jsx)(a.a,{href:\"#spring-security\\u548Copenid-connect\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Spring Security\\u548COpenID Connect\"]}),(0,n.jsxs)(a.h3,{id:\"\\u6982\\u8FF0\",children:[(0,n.jsx)(a.a,{href:\"#\\u6982\\u8FF0\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u6982\\u8FF0\"]}),(0,n.jsx)(a.p,{children:\"OpenID Connect \\u662F\\u4E00\\u4E2A\\u5F00\\u653E\\u6807\\u51C6\\uFF0C\\u7531 OpenID \\u57FA\\u91D1\\u4F1A\\u4E8E 2014 \\u5E74 2 \\u6708\\u53D1\\u5E03\\u3002\\u5B83\\u5B9A\\u4E49\\u4E86\\u4E00\\u79CD\\u4F7F\\u7528 OAuth 2.0 \\u6267\\u884C\\u7528\\u6237\\u8EAB\\u4EFD\\u8BA4\\u8BC1\\u7684\\u4E92\\u901A\\u65B9\\u5F0F\\u3002OpenID Connect \\u76F4\\u63A5\\u57FA\\u4E8E OAuth 2.0 \\u6784\\u5EFA\\uFF0C\\u5E76\\u4FDD\\u6301\\u4E0E\\u5B83\\u517C\\u5BB9\\u3002\"}),(0,n.jsxs)(a.p,{children:[\"\\u5F53\\u6388\\u6743\\u670D\\u52A1\\u5668\\u652F\\u6301 OIDC \\u65F6\\uFF0C\\u5B83\\u6709\\u65F6\\u88AB\\u79F0\\u4E3A\",(0,n.jsx)(a.em,{children:\"\\u8EAB\\u4EFD\\u63D0\\u4F9B\\u8005\\uFF08Idp\\uFF09\"}),\"\\uFF0C\\u56E0\\u4E3A\\u5B83\\u5411\",(0,n.jsx)(a.strong,{children:\"\\u5BA2\\u6237\\u7AEF\"}),\"\\u63D0\\u4F9B\\u6709\\u5173\",(0,n.jsx)(a.strong,{children:\"\\u8D44\\u6E90\\u6240\\u6709\\u8005\"}),\"\\u7684\\u4FE1\\u606F\\u3002\\u800C\",(0,n.jsx)(a.strong,{children:\"\\u5BA2\\u6237\\u7AEF\"}),\"\\u6620\\u5C04\\u4E3AOpenID Connect \\u6D41\\u7A0B\\u4E2D\",(0,n.jsx)(a.em,{children:\"\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\uFF08RP\\uFF09\"}),\"\\u3002\\u5728\\u672C\\u6587\\u4E2D\\u6211\\u4EEC\\u5C06\\u6388\\u6743\\u670D\\u52A1\\u79F0\\u4E3A\\u8EAB\\u4EFD\\u63D0\\u4F9B\\u8005\\uFF0C\\u5BA2\\u6237\\u7AEF\\u79F0\\u4E3A\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\u8FDB\\u884C\\u9648\\u8FF0\\u3002\"]}),(0,n.jsxs)(a.p,{children:[\"OpenID Connect \\u6D41\\u7A0B\\u770B\\u8D77\\u6765\\u4E0E OAuth \\u76F8\\u540C\\u3002\\u4E3B\\u8981\\u533A\\u522B\\u662F\\uFF0C\\u5728\\u6388\\u6743\\u8BF7\\u6C42\\u4E2D\\uFF0C\\u4F7F\\u7528\\u4E86\\u4E00\\u4E2A\\u7279\\u5B9A\\u7684\\u8303\\u56F4\",(0,n.jsx)(a.code,{children:\"openid\"}),\"\\uFF0C\\u800C\\u5728\\u83B7\\u53D6token\\u4E2D\\uFF0C\",(0,n.jsxs)(a.strong,{children:[\"\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\uFF08RP\\uFF09\",(0,n.jsx)(a.strong,{children:\"\\u540C\\u65F6\\u63A5\\u6536\\u5230\\u4E00\\u4E2A\"}),\"\\u8BBF\\u95EE\\u4EE4\\u724C\"]}),\"\\u548C\\u4E00\\u4E2A\",(0,n.jsx)(a.strong,{children:\"ID \\u4EE4\\u724C\"}),\"\\uFF08\\u7ECF\\u8FC7\\u7B7E\\u540D\\u7684 JWT\\uFF09\\u3002ID\\u4EE4\\u724C\\u4E0E\\u8BBF\\u95EE\\u4EE4\\u724C\\u4E0D\\u540C\\u7684\\u662F\\uFF0CID \\u4EE4\\u724C\\u662F\\u53D1\\u9001\\u7ED9 RP \\u7684\\uFF0C\\u5E76\\u4E14\\u8981\\u88AB\\u5B83\\u89E3\\u6790\\u3002\"]}),(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:\"\\u672C\\u6587\\u60A8\\u5C06\\u5B66\\u5230\"}),\"\\uFF1A\"]}),(0,n.jsxs)(a.ul,{children:[(0,n.jsx)(a.li,{children:\"\\u914D\\u7F6E\\u6388\\u6743\\u670D\\u52A1\\u652F\\u6301OpenID Connect\"}),(0,n.jsx)(a.li,{children:\"\\u81EA\\u5B9A\\u4E49ID\\u4EE4\\u724C\"}),(0,n.jsxs)(a.li,{children:[\"\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\u901A\\u8FC7\",(0,n.jsx)(a.code,{children:\"OAuth2UserService\"}),\"\\u5B9E\\u73B0\\u6743\\u9650\\u6620\\u5C04\"]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:\"\\u5148\\u51B3\\u6761\\u4EF6\\uFF1A\"})}),(0,n.jsxs)(a.ul,{children:[(0,n.jsx)(a.li,{children:\"java 8+\"}),(0,n.jsx)(a.li,{children:\"mysql\"})]}),(0,n.jsxs)(a.h3,{id:\"\\u4F7F\\u7528spring-authorization-server\\u642D\\u5EFA\\u8EAB\\u4EFD\\u63D0\\u4F9B\\u670D\\u52A1idp\",children:[(0,n.jsx)(a.a,{href:\"#\\u4F7F\\u7528spring-authorization-server\\u642D\\u5EFA\\u8EAB\\u4EFD\\u63D0\\u4F9B\\u670D\\u52A1idp\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u4F7F\\u7528Spring Authorization Server\\u642D\\u5EFA\\u8EAB\\u4EFD\\u63D0\\u4F9B\\u670D\\u52A1(IdP)\"]}),(0,n.jsxs)(a.p,{children:[\"\\u672C\\u8282\\u4E2D\\u6211\\u4EEC\\u5C06\\u4F7F\\u7528\",(0,n.jsx)(a.a,{href:\"https://spring.io/projects/spring-authorization-server\",children:\"Spring Authorization Server\"}),\"\\u642D\\u5EFA\\u8EAB\\u4EFD\\u63D0\\u4F9B\\u670D\\u52A1\\uFF0C\\u5E76\\u901A\\u8FC7\",(0,n.jsx)(a.code,{children:\"OAuth2TokenCustomizer\"}),\"\\u5B9E\\u73B0\\u81EA\\u5B9A\\u4E49ID Token\\u3002\"]}),(0,n.jsxs)(a.h4,{id:\"maven-\\u4F9D\\u8D56\\u9879\",children:[(0,n.jsx)(a.a,{href:\"#maven-\\u4F9D\\u8D56\\u9879\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"maven \\u4F9D\\u8D56\\u9879\"]}),(0,n.jsx)(a.pre,{className:\"language-xml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-xml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-security\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.security\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-security-oauth2-authorization-server\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"0.3.1\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-web\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})]})}),(0,n.jsxs)(a.h4,{id:\"\\u914D\\u7F6E\",children:[(0,n.jsx)(a.a,{href:\"#\\u914D\\u7F6E\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u914D\\u7F6E\"]}),(0,n.jsx)(a.p,{children:\"\\u9996\\u5148\\u6211\\u4EEC\\u914D\\u7F6E\\u8EAB\\u4EFD\\u63D0\\u4F9B\\u670D\\u52A1\\u7AEF\\u53E38080:\"}),(0,n.jsx)(a.pre,{className:\"language-yaml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"port\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"8080\"}),`\n`]})]})}),(0,n.jsxs)(a.p,{children:[\"\\u63A5\\u4E0B\\u6765\\u6211\\u4EEC\\u521B\\u5EFA\",(0,n.jsx)(a.code,{children:\"AuthorizationServerConfig\"}),\"\\u914D\\u7F6E\\u7C7B\\uFF0C\\u5728\\u6B64\\u7C7B\\u4E2D\\u6211\\u4EEC\\u914D\\u7F6EOAuth2\\u53CAOICD\\u76F8\\u5173Bean\\u3002\\u6211\\u4EEC\\u9996\\u5148\\u6CE8\\u518C\\u4E00\\u4E2A\\u5BA2\\u6237\\u7AEF\\uFF1A\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RegisteredClientRepository\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"registeredClientRepository\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RegisteredClient\"}),\" registeredClient \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RegisteredClient\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"withId\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"UUID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"randomUUID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toString\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"clientId\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"relive-client\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"clientSecret\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"{noop}relive-client\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"clientAuthenticationMethods\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"s \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                    s\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ClientAuthenticationMethod\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"CLIENT_SECRET_POST\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                    s\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ClientAuthenticationMethod\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"CLIENT_SECRET_BASIC\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizationGrantType\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"AuthorizationGrantType\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"AUTHORIZATION_CODE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizationGrantType\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"AuthorizationGrantType\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"REFRESH_TOKEN\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"redirectUri\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"http://127.0.0.1:8070/login/oauth2/code/messaging-client-oidc\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"scope\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcScopes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"OPENID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"scope\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcScopes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"PROFILE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"scope\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcScopes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"EMAIL\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"clientSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ClientSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"builder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"requireAuthorizationConsent\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"requireProofKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"tokenSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"TokenSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"builder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"accessTokenFormat\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2TokenFormat\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"SELF_CONTAINED\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"idTokenSignatureAlgorithm\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SignatureAlgorithm\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"RS256\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"accessTokenTimeToLive\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Duration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"ofSeconds\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"30\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"60\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"refreshTokenTimeToLive\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Duration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"ofSeconds\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"60\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"60\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"reuseRefreshTokens\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"InMemoryRegisteredClientRepository\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"registeredClient\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(a.p,{children:\"\\u6211\\u4EEC\\u6B63\\u5728\\u914D\\u7F6E\\u7684\\u5C5E\\u6027\\u662F\\uFF1A\"}),(0,n.jsxs)(a.ul,{children:[(0,n.jsx)(a.li,{children:\"clientId \\u2014\\u2014 Spring Security\\u5C06\\u4F7F\\u7528\\u5B83\\u6765\\u8BC6\\u522B\\u54EA\\u4E2A\\u5BA2\\u6237\\u7AEF\\u6B63\\u5728\\u5C1D\\u8BD5\\u8BBF\\u95EE\\u8D44\\u6E90\"}),(0,n.jsx)(a.li,{children:\"clientSecret\\u2014\\u2014\\u5BA2\\u6237\\u7AEF\\u548C\\u670D\\u52A1\\u5668\\u90FD\\u77E5\\u9053\\u7684\\u4E00\\u4E2A\\u79D8\\u5BC6\\uFF0C\\u5B83\\u63D0\\u4F9B\\u4E86\\u4E24\\u8005\\u4E4B\\u95F4\\u7684\\u4FE1\\u4EFB\"}),(0,n.jsx)(a.li,{children:\"clientAuthenticationMethod\\u2014\\u2014\\u5BA2\\u6237\\u7AEF\\u9A8C\\u8BC1\\u65B9\\u5F0F\\uFF0C\\u5728\\u6211\\u4EEC\\u7684\\u4F8B\\u5B50\\u4E2D\\uFF0C\\u6211\\u4EEC\\u5C06\\u652F\\u6301basic\\u548Cpost\\u8EAB\\u4EFD\\u9A8C\\u8BC1\\u65B9\\u5F0F\"}),(0,n.jsx)(a.li,{children:\"authorizationGrantType\\u2014\\u2014\\u6388\\u6743\\u7C7B\\u578B\\uFF0C\\u5141\\u8BB8\\u5BA2\\u6237\\u7AEF\\u751F\\u6210\\u6388\\u6743\\u7801\\u548C\\u5237\\u65B0\\u4EE4\\u724C\"}),(0,n.jsx)(a.li,{children:\"redirectUri \\u2014\\u2014 \\u91CD\\u5B9A\\u5411 URI\\uFF0C\\u5BA2\\u6237\\u7AEF\\u5C06\\u5728\\u57FA\\u4E8E\\u91CD\\u5B9A\\u5411\\u7684\\u6D41\\u7A0B\\u4E2D\\u4F7F\\u7528\\u5B83\"}),(0,n.jsxs)(a.li,{children:[\"scope\\u2014\\u2014\\u6B64\\u53C2\\u6570\\u5B9A\\u4E49\\u5BA2\\u6237\\u7AEF\\u53EF\\u80FD\\u62E5\\u6709\\u7684\\u6743\\u9650\\u3002\\u5728\\u6211\\u4EEC\\u7684\\u4F8B\\u5B50\\u4E2D\\uFF0C\\u6211\\u4EEC\\u5C06\\u62E5\\u6709\\u6240\\u9700\\u7684\",(0,n.jsx)(a.em,{children:\"OidcScopes.OPENID\"}),\"\\u548C\\u7528\\u6765\\u83B7\\u53D6\\u989D\\u5916\\u7684\",(0,n.jsx)(a.em,{children:\"\\u8EAB\\u4EFD\"}),\"\\u4FE1\\u606F\",(0,n.jsx)(a.em,{children:\"OidcScopes.PROFILE\"}),\"\\uFF0C\",(0,n.jsx)(a.em,{children:\"OidcScopes.EMAIL\"}),\"\\u3002\"]})]}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(a.p,{children:\"OpenID Connect \\u4F7F\\u7528\\u4E00\\u4E2A\\u7279\\u6B8A\\u7684\\u6743\\u9650\\u8303\\u56F4\\u503C openid \\u6765\\u63A7\\u5236\\u5BF9 UserInfo \\u7AEF\\u70B9\\u7684\\u8BBF\\u95EE\\u3002 OpenID Connect \\u5B9A\\u4E49\\u4E86\\u4E00\\u7EC4\\u6807\\u51C6\\u5316\\u7684 OAuth \\u6743\\u9650\\u8303\\u56F4\\uFF0C\\u5BF9\\u5E94\\u4E8E\\u7528\\u6237\\u5C5E\\u6027\\u7684\\u5B50\\u96C6profile\\u3001email\\u3001 phone\\u3001address\\uFF0C\\u53C2\\u89C1\\u8868\\u683C\\uFF1A\"}),(0,n.jsxs)(a.table,{children:[(0,n.jsx)(a.thead,{children:(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.th,{children:\"\\u6743\\u9650\\u8303\\u56F4\"}),(0,n.jsx)(a.th,{align:\"left\",children:\"\\u58F0\\u660E\"})]})}),(0,n.jsxs)(a.tbody,{children:[(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.td,{children:(0,n.jsx)(a.strong,{children:\"openid\"})}),(0,n.jsx)(a.td,{align:\"left\",children:(0,n.jsx)(a.strong,{children:\"sub\"})})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.td,{children:\"profile\"}),(0,n.jsx)(a.td,{align:\"left\",children:\"Name\\u3001family_name\\u3001given_name\\u3001middle_name\\u3001nickname\\u3001preferred_username\\u3001profile\\u3001 picture\\u3001website\\u3001gender\\u3001birthdate\\u3001zoneinfo\\u3001locale\\u3001updated_at\"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.td,{children:\"email\"}),(0,n.jsx)(a.td,{align:\"left\",children:\"email\\u3001email_verified\"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.td,{children:\"address\"}),(0,n.jsx)(a.td,{align:\"left\",children:\"address,\\u662F\\u4E00\\u4E2A JSON \\u5BF9\\u8C61\\u3001\\u5305\\u542B formatted\\u3001street_address\\u3001locality\\u3001region\\u3001postal_code\\u3001country\"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.td,{children:\"phone\"}),(0,n.jsx)(a.td,{align:\"left\",children:\"phone_number\\u3001phone_number_verified\"})]})]})]}),(0,n.jsxs)(a.p,{children:[\"\\u8BA9\\u6211\\u4EEC\\u6839\\u636E\\u4E0A\\u8FF0\\u89C4\\u8303\\u5B9A\\u4E49\",(0,n.jsx)(a.em,{children:\"OidcUserInfoService\"}),\"\\uFF0C\\u7528\\u4E8E\\u6269\\u5C55/userinfo\\u7528\\u6237\\u4FE1\\u606F\\u7AEF\\u70B9\\u54CD\\u5E94\\uFF1A\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserInfoService\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserInfo\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"loadUser\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Set\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" scopes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsxs)(a.span,{className:\"token class-name\",children:[\"OidcUserInfo\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"Builder\"]}),\" builder \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserInfo\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"builder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"subject\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"!\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"CollectionUtils\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"isEmpty\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"scopes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"scopes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"contains\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcScopes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"PROFILE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                builder\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"First Last\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"givenName\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"First\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"familyName\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Last\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"middleName\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Middle\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"nickname\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"User\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"preferredUsername\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"profile\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"http://127.0.0.1:8080/\"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" name\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"picture\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"http://127.0.0.1:8080/\"'}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" name \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\".jpg\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"website\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"http://127.0.0.1:8080/\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"gender\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"female\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"birthdate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"2022-05-24\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"zoneinfo\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"China/Beijing\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"locale\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"zh-cn\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"updatedAt\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"LocalDateTime\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"now\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"format\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"DateTimeFormatter\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"ISO_LOCAL_DATE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"scopes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"contains\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcScopes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"EMAIL\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                builder\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"email\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"name \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"@163.com\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"emailVerified\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"scopes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"contains\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcScopes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"ADDRESS\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JSONObject\"}),\" address \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JSONObject\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                address\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"address\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Collections\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"singletonMap\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"formatted\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"Champ de Mars\\\\n5 Av. Anatole France\\\\n75007 Paris\\\\nFrance\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                builder\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"address\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"address\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toJSONString\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"scopes\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"contains\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcScopes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"PHONE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                builder\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"phoneNumber\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"13728903134\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"phoneNumberVerified\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"false\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" builder\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(a.p,{children:[\"\\u63A5\\u4E0B\\u6765\\uFF0C\\u6211\\u4EEC\\u5C06\\u914D\\u7F6E\\u4E00\\u4E2A bean \\u4EE5\\u5E94\\u7528\\u9ED8\\u8BA4 OAuth \\u5B89\\u5168\\u6027\\u3002\\u4F7F\\u7528\\u4E0A\\u8FF0\",(0,n.jsx)(a.em,{children:\"OidcUserInfoService\"}),\"\\u914D\\u7F6EOIDC\\u4E2DUserInfoMapper\\uFF1Boauth2ResourceServer()\\u914D\\u7F6E\\u8D44\\u6E90\\u670D\\u52A1\\u5668\\u4F7F\\u7528JWT\\u9A8C\\u8BC1\\uFF0C\\u7528\\u6765\\u4FDD\\u62A4Spring Security \\u63D0\\u4F9B\\u7684/userinfo\\u7AEF\\u70B9\\uFF1B\\u5BF9\\u4E8E\\u672A\\u8BA4\\u8BC1\\u8BF7\\u6C42\\u6211\\u4EEC\\u4F1A\\u5C06\\u5B83\\u91CD\\u5B9A\\u5411\\u5230/login \\u767B\\u5F55\\u9875\\uFF1A\"]}),(0,n.jsx)(a.blockquote,{children:(0,n.jsx)(a.p,{children:\"\\u6CE8\\u610F\\uFF1A\\u6709\\u65F6\\u201C\\u6388\\u6743\\u670D\\u52A1\\u5668\\u201D\\u548C\\u201C\\u8D44\\u6E90\\u670D\\u52A1\\u5668\\u201D\\u662F\\u540C\\u4E00\\u53F0\\u670D\\u52A1\\u5668\\u3002\"})}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Order\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Ordered\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"HIGHEST_PRECEDENCE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityFilterChain\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizationServerSecurityFilterChain\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HttpSecurity\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizationServerConfigurer\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HttpSecurity\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" authorizationServerConfigurer \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizationServerConfigurer\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"//\\u81EA\\u5B9A\\u4E49\\u7528\\u6237\\u6620\\u5C04\\u5668\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Function\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserInfoAuthenticationContext\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserInfo\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" userInfoMapper \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserInfoAuthenticationToken\"}),\" authentication \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" context\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getAuthentication\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JwtAuthenticationToken\"}),\" principal \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JwtAuthenticationToken\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" authentication\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getPrincipal\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" userInfoService\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"loadUser\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"principal\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getName\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" context\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getAccessToken\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getScopes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        authorizationServerConfigurer\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"oidc\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"oidc\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            oidc\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"userInfoEndpoint\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"userInfo\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" userInfo\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"userInfoMapper\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"userInfoMapper\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RequestMatcher\"}),\" endpointsMatcher \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" authorizationServerConfigurer\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getEndpointsMatcher\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"requestMatcher\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"endpointsMatcher\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizeRequests\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizeRequests\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(a.span,{className:\"token class-name\",children:[\"ExpressionUrlAuthorizationConfigurer\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"AuthorizedUrl\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" authorizeRequests\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"anyRequest\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authenticated\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"csrf\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"csrf\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            csrf\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"ignoringRequestMatchers\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RequestMatcher\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\"endpointsMatcher\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"apply\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizationServerConfigurer\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"and\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"oauth2ResourceServer\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2ResourceServerConfigurer\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"jwt\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"exceptionHandling\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"exceptions \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" exceptions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token function\",children:\"authenticationEntryPoint\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"LoginUrlAuthenticationEntryPoint\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"/login\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"apply\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizationServerConfigurer\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"and\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(a.p,{children:\"\\u6BCF\\u4E2A\\u6388\\u6743\\u670D\\u52A1\\u5668\\u90FD\\u9700\\u8981\\u5176\\u7528\\u4E8E\\u4EE4\\u724C\\u7684\\u7B7E\\u540D\\u5BC6\\u94A5\\uFF0C\\u8BA9\\u6211\\u4EEC\\u751F\\u6210\\u4E00\\u4E2A 2048 \\u5B57\\u8282\\u7684 RSA \\u5BC6\\u94A5\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JWKSource\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityContext\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"jwkSource\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAKey\"}),\" rsaKey \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Jwks\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"generateRsa\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JWKSet\"}),\" jwkSet \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JWKSet\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"rsaKey\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"jwkSelector\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" securityContext\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" jwkSelector\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"select\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"jwkSet\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Jwks\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Jwks\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAKey\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"generateRsa\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPair\"}),\" keyPair \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyGeneratorUtils\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"generateRsaKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAPublicKey\"}),\" publicKey \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAPublicKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" keyPair\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getPublic\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAPrivateKey\"}),\" privateKey \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAPrivateKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" keyPair\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getPrivate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(a.span,{className:\"token class-name\",children:[\"RSAKey\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"Builder\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"publicKey\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"privateKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"privateKey\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"keyID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"UUID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"randomUUID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toString\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyGeneratorUtils\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyGeneratorUtils\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPair\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"generateRsaKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPair\"}),\" keyPair\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPairGenerator\"}),\" keyPairGenerator \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPairGenerator\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getInstance\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"RSA\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      keyPairGenerator\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"initialize\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"2048\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      keyPair \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" keyPairGenerator\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"generateKeyPair\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" ex\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throw\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"IllegalStateException\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"ex\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" keyPair\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(a.p,{children:[\"\\u7136\\u540E\\u6211\\u4EEC\\u5C06\\u4F7F\\u7528\\u5E26\\u6709@\",(0,n.jsx)(a.em,{children:\"EnableWebSecurity\"}),\"\\u6CE8\\u91CA\\u7684\\u914D\\u7F6E\\u7C7B\\u542F\\u7528 Spring Web \\u5B89\\u5168\\u6A21\\u5757\\uFF1A\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Configuration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"proxyBeanMethods \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@EnableWebSecurity\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"DefaultSecurityConfig\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityFilterChain\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"defaultSecurityFilterChain\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HttpSecurity\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`        http\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizeRequests\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizeRequests \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        authorizeRequests\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"anyRequest\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authenticated\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"formLogin\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"withDefaults\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"//...\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsx)(a.p,{children:\"\\u8FD9\\u91CC\\u6211\\u4EEC\\u4F7F\\u7528Form\\u8868\\u5355\\u8BA4\\u8BC1\\u65B9\\u5F0F\\uFF0C\\u6240\\u4EE5\\u6211\\u4EEC\\u8FD8\\u9700\\u8981\\u4E3A\\u767B\\u5F55\\u8BA4\\u8BC1\\u63D0\\u4F9B\\u7528\\u6237\\u540D\\u548C\\u5BC6\\u7801\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UserDetailsService\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"users\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UserDetails\"}),\" user \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"User\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"withDefaultPasswordEncoder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"username\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"admin\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"password\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"password\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"roles\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"ADMIN\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"InMemoryUserDetailsManager\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"user\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(a.p,{children:[\"\\u81F3\\u6B64\\uFF0C\\u6211\\u4EEC\\u670D\\u52A1\\u914D\\u7F6E\\u5B8C\\u6210\\uFF0C\\u4F46\\u662F\\u7528\\u4E8E\\u7ED9\\u5BA2\\u6237\\u7AEF\\u4F20\\u9012\\u6743\\u9650\\u4FE1\\u606F\\uFF0C\\u6211\\u4EEC\\u5C06\\u66F4\\u6539\",(0,n.jsx)(a.code,{children:\"ID Token\"}),\" claim\\uFF0C\\u6DFB\\u52A0\\u7528\\u6237\\u89D2\\u8272\\u5C5E\\u6027\\uFF1A\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Configuration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"proxyBeanMethods \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"IdTokenCustomizerConfig\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2TokenCustomizer\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JwtEncodingContext\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"tokenCustomizer\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcParameterNames\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"ID_TOKEN\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"equals\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getTokenType\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getValue\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                context\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getClaims\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"claims\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"claims \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        claims\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"role\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" context\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getPrincipal\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getAuthorities\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"stream\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"GrantedAuthority\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getAuthority\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"collect\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Collectors\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toSet\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.h3,{id:\"\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\u670D\\u52A1rp\\u5B9E\\u73B0\",children:[(0,n.jsx)(a.a,{href:\"#\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\u670D\\u52A1rp\\u5B9E\\u73B0\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\u670D\\u52A1\\uFF08RP\\uFF09\\u5B9E\\u73B0\"]}),(0,n.jsxs)(a.p,{children:[\"\\u672C\\u8282\\u4E2D\\u6211\\u4EEC\\u5C06\\u4F7F\\u7528Spring Security\\u642D\\u5EFA\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\u670D\\u52A1\\uFF0C\\u5E76\\u8BBE\\u8BA1\\u76F8\\u5173\\u6570\\u636E\\u5E93\\u8868\\u7ED3\\u6784\\u8868\\u8FBE\\u5173\\u8054\\u8EAB\\u4EFD\\u63D0\\u4F9B\\u65B9\\u670D\\u52A1\\u4E0E\\u767B\\u5F55\\u4F9D\\u8D56\\u65B9\\u670D\\u52A1\\u6743\\u9650\\u5173\\u7CFB\\uFF0C\\u901A\\u8FC7\",(0,n.jsx)(a.code,{children:\"OAuth2UserService\"}),\"\\u5B9E\\u73B0\\u6743\\u9650\\u6620\\u5C04\\u3002\"]}),(0,n.jsx)(a.p,{children:\"\\u672C\\u8282\\u4E2D\\u90E8\\u5206\\u4EE3\\u7801\\u6D89\\u53CAJPA\\u76F8\\u5173\\u77E5\\u8BC6\\uFF0C\\u5982\\u679C\\u60A8\\u5E76\\u4E0D\\u4E86\\u89E3\\u4E5F\\u6CA1\\u6709\\u5173\\u7CFB\\uFF0C\\u60A8\\u53EF\\u4EE5\\u901A\\u8FC7Mybatis\\u8FDB\\u884C\\u66FF\\u6362\\u3002\"}),(0,n.jsxs)(a.h4,{id:\"maven-\\u4F9D\\u8D56\\u9879-1\",children:[(0,n.jsx)(a.a,{href:\"#maven-\\u4F9D\\u8D56\\u9879-1\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"maven \\u4F9D\\u8D56\\u9879\"]}),(0,n.jsx)(a.pre,{className:\"language-xml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-xml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-web\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-oauth2-client\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-data-jdbc\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-data-jpa\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-thymeleaf\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"mysql\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"mysql-connector-java\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"8.0.21\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})]})}),(0,n.jsxs)(a.h4,{id:\"\\u76F8\\u5173\\u6570\\u636E\\u5E93\\u8868\\u7ED3\\u6784\",children:[(0,n.jsx)(a.a,{href:\"#\\u76F8\\u5173\\u6570\\u636E\\u5E93\\u8868\\u7ED3\\u6784\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u76F8\\u5173\\u6570\\u636E\\u5E93\\u8868\\u7ED3\\u6784\"]}),(0,n.jsxs)(a.p,{children:[\"\\u8FD9\\u662F\\u6211\\u4EEC\\u672C\\u6587\\u4E2DRP\\u670D\\u52A1\\u4F7F\\u7528\\u7684\\u76F8\\u5173\\u6570\\u636E\\u5E93\\u8868\\uFF0C\\u6D89\\u53CA\\u76F8\\u5173\\u521B\\u5EFA\\u8868\\u53CA\\u521D\\u59CB\\u5316\\u6570\\u636E\\u7684SQL\\u8BED\\u53E5\\u53EF\\u4EE5\",(0,n.jsx)(a.a,{href:\"https://github.com/ReLive27/spring-security-oauth2-sample/tree/main/oidc-login/rp/src/main/resources/db/migration\",children:\"\\u4ECE\\u8FD9\\u91CC\"}),\"\\u83B7\\u53D6\\u3002\"]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.img,{alt:\"\",src:\"../static/images/blogs/spring-oidc-sql-model.png\"})}),(0,n.jsxs)(a.h4,{id:\"\\u914D\\u7F6E-1\",children:[(0,n.jsx)(a.a,{href:\"#\\u914D\\u7F6E-1\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u914D\\u7F6E\"]}),(0,n.jsx)(a.p,{children:\"\\u9996\\u5148\\u6211\\u4EEC\\u901A\\u8FC7application.yml\\u6587\\u4EF6\\u4E2D\\u914D\\u7F6E\\u670D\\u52A1\\u7AEF\\u53E3\\u548C\\u6570\\u636E\\u5E93\\u8FDE\\u63A5\\u4FE1\\u606F\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-yaml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"port\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"8070\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"servlet\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"session\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"cookie\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" CLIENT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`SESSION\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"spring\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"datasource\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"druid\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"db-type\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` mysql\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"driver-class-name\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` com.mysql.cj.jdbc.Driver\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"url\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" jdbc\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"mysql\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//localhost\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"3306/oidc_login\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"?\"}),\"createDatabaseIfNotExist=true\",(0,n.jsx)(a.span,{className:\"token important\",children:\"\u0026useUnicode=true\u0026characterEncoding=UTF-8\u0026useSSL=false\u0026serverTimezone=Asia/Shanghai\u0026allowPublicKeyRetrieval=true\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"username\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \u003c\u003croot\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"# \\u4FEE\\u6539\\u7528\\u6237\\u540D\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"password\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \u003c\u003cpassword\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"# \\u4FEE\\u6539\\u5BC6\\u7801\"}),`\n`]})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(a.p,{children:[\"\\u63A5\\u4E0B\\u6765\\u6211\\u4EEC\\u5C06\\u542F\\u7528Spring Security\\u5B89\\u5168\\u914D\\u7F6E\\u3002\\u4F7F\\u7528Form\\u8BA4\\u8BC1\\u65B9\\u5F0F\\uFF1B\\u5E76\\u4F7F\\u7528\",(0,n.jsx)(a.em,{children:\"oauth2Login\"}),\"()\\u5B9A\\u4E49OAuth2\\u767B\\u5F55\\u9ED8\\u8BA4\\u914D\\u7F6E\\uFF1A\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityFilterChain\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"securityFilterChain\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HttpSecurity\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizeHttpRequests\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"anyRequest\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authenticated\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"and\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"formLogin\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"from \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                    from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"defaultSuccessUrl\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"/home\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"oauth2Login\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Customizer\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"withDefaults\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"csrf\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"disable\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(a.p,{children:[\"\\u4E0B\\u9762\\u6211\\u4EEC\\u5C06\\u914D\\u7F6EOAuth2\\u5BA2\\u6237\\u7AEF\\u57FA\\u4E8EMySql\\u6570\\u636E\\u5E93\\u7684\\u5B58\\u50A8\\u65B9\\u5F0F\\uFF0C\\u4F60\\u4E5F\\u53EF\\u4EE5\\u4ECE\",(0,n.jsx)(a.a,{href:\"https://relive27.github.io/blog/persisrence-oauth2-client\",children:\"Spring Security \\u6301\\u4E45\\u5316OAuth2\\u5BA2\\u6237\\u7AEF\"}),\"\\u4E86\\u89E3\\u8BE6\\u7EC6\\u4FE1\\u606F\\u3002\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:`/**\n`})]}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:`     * \\u5B9A\\u4E49JDBC \\u5BA2\\u6237\\u7AEF\\u6CE8\\u518C\\u5B58\\u50A8\\u5E93\n`})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:`     *\n`})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsxs)(a.span,{className:\"token comment doc-comment\",children:[\"     * \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"@param\"}),\" \",(0,n.jsx)(a.span,{className:\"token parameter\",children:\"jdbcTemplate\"}),`\n`]})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsxs)(a.span,{className:\"token comment doc-comment\",children:[\"     * \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"@return\"}),`\n`]})}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:\"     */\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ClientRegistrationRepository\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"clientRegistrationRepository\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JdbcTemplate\"}),\" jdbcTemplate\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JdbcClientRegistrationRepository\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"jdbcTemplate\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:`/**\n`})]}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsxs)(a.span,{className:\"token comment doc-comment\",children:[\"     * \\u8D1F\\u8D23\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"@link\"}),\" \",(0,n.jsxs)(a.span,{className:\"token reference\",children:[(0,n.jsxs)(a.span,{className:\"token namespace\",children:[\"org\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"springframework\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"security\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"oauth2\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"})]}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClient\"})]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\\u5728 Web \\u8BF7\\u6C42\\u4E4B\\u95F4\\u8FDB\\u884C\\u6301\\u4E45\\u5316\n`]})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:`     *\n`})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsxs)(a.span,{className:\"token comment doc-comment\",children:[\"     * \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"@param\"}),\" \",(0,n.jsx)(a.span,{className:\"token parameter\",children:\"jdbcTemplate\"}),`\n`]})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsxs)(a.span,{className:\"token comment doc-comment\",children:[\"     * \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"@param\"}),\" \",(0,n.jsx)(a.span,{className:\"token parameter\",children:\"clientRegistrationRepository\"}),`\n`]})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsxs)(a.span,{className:\"token comment doc-comment\",children:[\"     * \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"@return\"}),`\n`]})}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:\"     */\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClientService\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizedClientService\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JdbcTemplate\"}),\" jdbcTemplate\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ClientRegistrationRepository\"}),\" clientRegistrationRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JdbcOAuth2AuthorizedClientService\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"jdbcTemplate\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" clientRegistrationRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:`/**\n`})]}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:`     * OAuth2AuthorizedClientRepository \\u662F\\u4E00\\u4E2A\\u5BB9\\u5668\\u7C7B\\uFF0C\\u7528\\u4E8E\\u5728\\u8BF7\\u6C42\\u4E4B\\u95F4\\u4FDD\\u5B58\\u548C\\u6301\\u4E45\\u5316\\u6388\\u6743\\u5BA2\\u6237\\u7AEF\n`})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:`     *\n`})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsxs)(a.span,{className:\"token comment doc-comment\",children:[\"     * \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"@param\"}),\" \",(0,n.jsx)(a.span,{className:\"token parameter\",children:\"authorizedClientService\"}),`\n`]})}),(0,n.jsx)(a.span,{className:\"code-line\",children:(0,n.jsxs)(a.span,{className:\"token comment doc-comment\",children:[\"     * \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"@return\"}),`\n`]})}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment doc-comment\",children:\"     */\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClientRepository\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizedClientRepository\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClientService\"}),\" authorizedClientService\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"AuthenticatedPrincipalOAuth2AuthorizedClientRepository\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizedClientService\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(a.p,{children:[\"\\u6211\\u4EEC\\u4E0D\\u5728\\u4F7F\\u7528\\u57FA\\u4E8E\\u5185\\u5B58\\u7684\\u7528\\u6237\\u540D\\u5BC6\\u7801\\uFF0C\\u5728\\u521D\\u59CB\\u5316\\u6570\\u636E\\u5E93\\u65F6\\u6211\\u4EEC\\u5DF2\\u7ECF\\u5C06\\u7528\\u6237\\u540D\\u5BC6\\u7801\\u6DFB\\u52A0\\u5230user\\u8868\\u4E2D\\uFF0C\\u6240\\u4EE5\\u6211\\u4EEC\\u9700\\u8981\\u5B9E\\u73B0\",(0,n.jsx)(a.em,{children:\"UserDetailsService\"}),\"\\u63A5\\u53E3\\u7528\\u4E8EForm\\u8BA4\\u8BC1\\u65F6\\u83B7\\u53D6\\u7528\\u6237\\u4FE1\\u606F\\uFF1A\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@RequiredArgsConstructor\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JdbcUserDetailsService\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UserDetailsService\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UserRepository\"}),\" userRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Override\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UserDetails\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"loadUserByUsername\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" username\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UsernameNotFoundException\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsxs)(a.span,{className:\"token class-name\",children:[(0,n.jsxs)(a.span,{className:\"token namespace\",children:[\"com\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"relive\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"entity\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"})]}),\"User\"]}),\" user \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" userRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"findUserByUsername\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ObjectUtils\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"isEmpty\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"user\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throw\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UsernameNotFoundException\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"user is not found\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"CollectionUtils\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"isEmpty\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"user\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getRoleList\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throw\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UsernameNotFoundException\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"role is not found\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Set\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SimpleGrantedAuthority\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" authorities \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" user\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getRoleList\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"stream\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Role\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getRoleCode\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SimpleGrantedAuthority\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"collect\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Collectors\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toSet\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"User\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"user\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getUsername\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" user\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getPassword\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" authorities\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsxs)(a.p,{children:[\"\\u8FD9\\u91CC\",(0,n.jsx)(a.em,{children:\"UserRepository\"}),\"\\u7EE7\\u627F\\u4E86\",(0,n.jsx)(a.em,{children:\"JpaRepository\"}),\"\\uFF0C\\u63D0\\u4F9Buser\\u8868\\u7684CRUD\\uFF0C\\u8BE6\\u7EC6\\u4EE3\\u7801\\u53EF\\u4EE5\\u5728\\u6587\\u672B\\u94FE\\u63A5\\u4E2D\\u83B7\\u53D6\\u3002\"]}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(a.p,{children:[\"\\u73B0\\u5728\\u6211\\u4EEC\\u5C06\\u8981\\u89E3\\u51B3\\u5982\\u4F55\\u5C06IdP\\u670D\\u52A1\\u7528\\u6237\\u89D2\\u8272\\u6620\\u5C04\\u4E3ARP\\u670D\\u52A1\\u5DF2\\u6709\\u7684\\u89D2\\u8272\\uFF0C\\u5728\",(0,n.jsx)(a.a,{href:\"https://relive27.github.io/blog/oauth2-login\",children:\"\\u524D\\u9762\\u6587\\u7AE0\"}),\"\\u4E2D\\u66FE\\u4F7F\\u7528\",(0,n.jsx)(a.code,{children:\"GrantedAuthoritiesMapper\"}),\"\\u6620\\u5C04\\u89D2\\u8272\\u3002\\u5728\\u672C\\u6587\\u4E2D\\u6211\\u4EEC\\u5C06\\u4F7F\\u7528\",(0,n.jsx)(a.em,{children:\"OAuth2UserService\"}),\"\\u6DFB\\u52A0\\u89D2\\u8272\\u6620\\u5C04\\u7B56\\u7565\\uFF0C\\u5B83\\u4E0E\",(0,n.jsx)(a.code,{children:\"GrantedAuthoritiesMapper\"}),\"\\u76F8\\u6BD4\\u66F4\\u52A0\\u7075\\u6D3B:\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcRoleMappingUserService\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2UserService\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserRequest\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUser\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserService\"}),\" oidcUserService\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2ClientRoleRepository\"}),\" oAuth2ClientRoleRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"//...\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Override\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUser\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"loadUser\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUserRequest\"}),\" userRequest\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthenticationException\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcUser\"}),\" oidcUser \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" oidcUserService\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"loadUser\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"userRequest\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OidcIdToken\"}),\" idToken \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" userRequest\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getIdToken\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" role \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" idToken\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getClaimAsStringList\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"role\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Set\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SimpleGrantedAuthority\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" mappedAuthorities \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" role\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"stream\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"r \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" oAuth2ClientRoleRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"findByClientRegistrationIdAndRoleCode\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"userRequest\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getClientRegistration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getRegistrationId\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2ClientRole\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getRole\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Role\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getRoleCode\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SimpleGrantedAuthority\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"collect\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Collectors\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toSet\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        oidcUser \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"DefaultOidcUser\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"mappedAuthorities\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" oidcUser\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getIdToken\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" oidcUser\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getUserInfo\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" oidcUser\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsxs)(a.p,{children:[\"\\u6700\\u540E\\u6211\\u4EEC\\u5C06\\u521B\\u5EFAHomeController\\uFF0C\\u901A\\u8FC7\\u63A7\\u5236\\u9875\\u9762\\u4E2D\\u5C55\\u793A\\u5185\\u5BB9\\u4F7F\\u6D4B\\u8BD5\\u6548\\u679C\\u89C6\\u89C9\\u4E0A\\u66F4\\u52A0\\u663E\\u8457\\uFF0C\\u6211\\u4EEC\\u5C06\\u6839\\u636E\\u89D2\\u8272\\u5C55\\u793A\\u4E0D\\u540C\\u4FE1\\u606F\\uFF0C\\u4F7F\\u7528\",(0,n.jsx)(a.a,{href:\"https://www.thymeleaf.org/\",children:\"thymeleaf\"}),\"\\u6A21\\u7248\\u5F15\\u64CE\\u6E32\\u67D3\\u3002\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Controller\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HomeController\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Map\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" articles \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HashMap\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        articles\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"ROLE_OPERATION\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Arrays\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"asList\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Java\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        articles\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"put\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"ROLE_SYSTEM\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Arrays\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"asList\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"Java\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"Python\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"C++\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@GetMapping\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"/home\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"home\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Authentication\"}),\" authentication\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Model\"}),\" model\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),\" authority \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" authentication\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getAuthorities\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"iterator\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"next\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getAuthority\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        model\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"addAttribute\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"articles\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" articles\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authority\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"home\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsxs)(a.p,{children:[\"\\u5B8C\\u6210\\u914D\\u7F6E\\u540E\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u8BBF\\u95EE \",(0,n.jsx)(a.a,{href:\"http://127.0.0.1:8070/login\",children:\"http://127.0.0.1:8070/login\"}),\" \\u8FDB\\u884C\\u6D4B\\u8BD5\\u3002\"]}),(0,n.jsxs)(a.h3,{id:\"\\u7ED3\\u8BBA\",children:[(0,n.jsx)(a.a,{href:\"#\\u7ED3\\u8BBA\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u7ED3\\u8BBA\"]}),(0,n.jsxs)(a.p,{children:[\"\\u5728\\u672C\\u6587\\u4E2D\\u5206\\u4EAB\\u4E86Spring Security\\u5BF9\\u4E8EOpenID Connect\\u7684\\u652F\\u6301\\u3002\\u4E0E\\u5F80\\u5E38\\u4E00\\u6837\\uFF0C\\u672C\\u6587\\u4E2D\\u4F7F\\u7528\\u7684\\u6E90\\u4EE3\\u7801\\u53EF\",(0,n.jsx)(a.a,{href:\"https://github.com/ReLive27/spring-security-oauth2-sample/tree/main/oidc-login\",children:\"\\u5728 GitHub \\u4E0A\"}),\"\\u83B7\\u5F97\\u3002\"]})]})}}var w=y;return S;})();\n;return Component;","toc":[{"value":"Spring Security和OpenID Connect","url":"#spring-security和openid-connect","depth":2},{"value":"概述","url":"#概述","depth":3},{"value":"使用Spring Authorization Server搭建身份提供服务(IdP)","url":"#使用spring-authorization-server搭建身份提供服务idp","depth":3},{"value":"maven 依赖项","url":"#maven-依赖项","depth":4},{"value":"配置","url":"#配置","depth":4},{"value":"登录依赖方服务（RP）实现","url":"#登录依赖方服务rp实现","depth":3},{"value":"maven 依赖项","url":"#maven-依赖项","depth":4},{"value":"相关数据库表结构","url":"#相关数据库表结构","depth":4},{"value":"配置","url":"#配置","depth":4},{"value":"结论","url":"#结论","depth":3}],"frontMatter":{"readingTime":{"text":"16 min read","minutes":15.07,"time":904200,"words":3014},"slug":"springn-security-oidc","fileName":"springn-security-oidc.md","title":"Spring Security和OpenID Connect","date":"2022-08-01T20:35:28.000Z","tags":["OAuth2","SpringSecurity"],"draft":false,"authors":["default"]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.18,"time":10800,"words":36},"slug":["default"],"fileName":"default.md","name":"ReLive27","avatar":"../static/images/avatar.png","occupation":"中级软件工程师","date":null}],"prev":{"title":"Spring Security OAuth2登录","date":"2022-07-25T20:01:01.000Z","tags":["OAuth2","SpringSecurity"],"draft":false,"authors":["default"],"slug":"oauth2-login"},"next":{"title":"将Spring Cloud Gateway 与OAuth2模式一起使用","date":"2022-08-13T12:07:52.000Z","tags":["OAuth2","SpringSecurity"],"draft":false,"authors":["default"],"slug":"spring-gateway-oauth2"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["springn-security-oidc"]},"buildId":"TGn5Ov6tzxMTY3j5IMXdM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>