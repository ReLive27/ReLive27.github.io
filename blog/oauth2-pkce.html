<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Spring Security OAuth2 带有用于代码交换的证明密钥 (PKCE) 的授权码流</title><meta name="robots" content="follow, index"/><meta name="description"/><meta property="og:url" content="/blog/oauth2-pkce"/><meta property="og:type" content="article"/><meta property="og:site_name" content="ReLive27 Blog"/><meta property="og:description"/><meta property="og:title" content="Spring Security OAuth2 带有用于代码交换的证明密钥 (PKCE) 的授权码流"/><meta property="og:image" content="/static/images/banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/Twitter"/><meta name="twitter:title" content="Spring Security OAuth2 带有用于代码交换的证明密钥 (PKCE) 的授权码流"/><meta name="twitter:description"/><meta name="twitter:image" content="/static/images/banner.png"/><link rel="canonical" href="/blog/oauth2-pkce"/><meta property="article:published_time" content="2022-07-17T12:21:50.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/blog/oauth2-pkce"
  },
  "headline": "Spring Security OAuth2 带有用于代码交换的证明密钥 (PKCE) 的授权码流",
  "image": [
    {
      "@type": "ImageObject",
      "url": "/static/images/banner.png"
    }
  ],
  "datePublished": "2022-07-17T12:21:50.000Z",
  "dateModified": "2022-07-17T12:21:50.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "ReLive27"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "ReLive27",
    "logo": {
      "@type": "ImageObject",
      "url": "/static/images/logo.png"
    }
  }
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/71f5d2b63ae3ac20.css" as="style"/><link rel="stylesheet" href="/_next/static/css/71f5d2b63ae3ac20.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-90a0fcdc7d29419f.js" defer=""></script><script src="/_next/static/chunks/main-fff4bba495d1f787.js" defer=""></script><script src="/_next/static/chunks/pages/_app-56103142a29604f1.js" defer=""></script><script src="/_next/static/chunks/675-415f2ef004e9374e.js" defer=""></script><script src="/_next/static/chunks/811-09b059e602669e04.js" defer=""></script><script src="/_next/static/chunks/410-1fac91fa0a8ba801.js" defer=""></script><script src="/_next/static/chunks/1-31d270f28099c1e5.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-a331338351da50bc.js" defer=""></script><script src="/_next/static/ncYKBo26SAMSsuoTiRfZ4/_buildManifest.js" defer=""></script><script src="/_next/static/ncYKBo26SAMSsuoTiRfZ4/_ssgManifest.js" defer=""></script><script src="/_next/static/ncYKBo26SAMSsuoTiRfZ4/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="ReLive27" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">ReLive27</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/">Home</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/columns">Column</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/contact">Contact</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/">Home</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/columns">Column</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/contact">Contact</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-07-17T12:21:50.000Z">2022年7月17日星期日</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Spring Security OAuth2 带有用于代码交换的证明密钥 (PKCE) 的授权码流</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="../static/images/avatar.png?imwidth=48 1x, ../static/images/avatar.png?imwidth=96 2x" src="../static/images/avatar.png?imwidth=96" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">ReLive27</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="spring-security-oauth2-带有用于代码交换的证明密钥-pkce-的授权码流"><a href="#spring-security-oauth2-带有用于代码交换的证明密钥-pkce-的授权码流" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Spring Security OAuth2 带有用于代码交换的证明密钥 (PKCE) 的授权码流</h2><p><img alt="" src="../static/images/blogs/oauth2.png"/></p><h3 id="概述"><a href="#概述" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>概述</h3><p>OAuth2依据是否能持有客户端密钥，将客户端分为两种类型：<strong>公共客户端</strong>和<strong>保密客户端</strong>。</p><p><strong>保密客户端</strong>在服务器上运行，在前面介绍OAuth2文章中Spring Boot创建的应用程序是保密客户端类型的示例。首先它们在服务器上运行，并且通常位于具有其他保护措施防火墙或网关的后面。</p><p><strong>公共客户端</strong>的代码一般会以某种形式暴露给最终用户，要么是在浏览器中下载执行，要么是直接在用户的设备上运行。例如<strong>原生应用</strong>是直接在最终用户的设备（计算机或者移动设备）上运行的应用。这类应用在使用OAuth2协议时，我们无法保证为此应用颁发的客户端密钥能安全的存储，因为这些应用程序在运行之前会完全下载到设备上，反编译应用程序将完全显示客户端密钥。</p><p>同样存在此安全问题还有<strong>单页应用</strong>（SPA），浏览器本身是一个不安全的环境，一旦你加载JavaScript应用程序，浏览器将会下载整个源代码以便运行它，整个源代码，包括其中的任何 客户端密钥，都将可见。如果你构建一个拥有100000名用户的应用程序，那么很可能这些用户中的一部分将感染恶意软件或病毒，并泄漏客户端密钥。</p><p>你可能会想，“如果我通过将客户端密钥拆分为几个部分进行混淆呢？”这不可否认会为你争取点时间，但真正有决心的人仍可能会弄清楚。</p><p>为了规避这种安全风险，最好使用代码交换证明密钥(PKCE)。</p><h3 id="proof-key-for-code-exchange"><a href="#proof-key-for-code-exchange" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Proof Key for Code Exchange</h3><p>PKCE 有自己独立的<a target="_blank" rel="noopener noreferrer" href="https://tools.ietf.org/html/rfc7636">规范</a>。它使应用程序能够在公共客户端中使用授权码流程。</p><p><img alt="" src="../static/images/blogs/PKCE.drawio.png"/></p><ol><li><p>用户在客户端请求资源。</p></li><li><p>客户端创建并记录名为 code_verifier 的秘密信息，然后客户端根据 code_verifier 计算出 code_challenge，它的值可以是 code_verifier，也可以是 code_verifier 的 SHA-256 散列，但是应该优先考虑使用密码散列，因为它能防止验证器本身遭到截获。</p></li><li><p>客户端将 code_challenge 以及可选的 code_challenge_method(一个关键字，表 示原文或者 SHA-256 散列)与常规的授权请求参数一起发送给授权服务器。</p></li><li><p>授权服务器将用户重定向到登录页面。</p></li><li><p>用户使进行身份验证，并且可能会看到一个同意页面，其中列出了 授权服务器将授予客户端的权限。</p></li><li><p>授权服务器将 code_challenge 和 code_challenge_method(如果有 的话)记录下来。授权服务器会将这些信息与颁发的授权码关联起来，并携带code重定向回客户端。</p></li><li><p>客户端接收到授权码之后，携带之前生成的 code_verifier 执行令牌请求。</p></li><li><p>授权服务器根据code_verifier计算出 code_challenge，并检查是否与最初提交的code_challenge一致。</p></li><li><p>授权服务器向客户端发送令牌。</p></li><li><p>客户端向受保护资源发送令牌。</p></li><li><p>受保护资源向客户端返回资源。</p></li></ol><h3 id="使用spring-authorization-server搭建授权服务器"><a href="#使用spring-authorization-server搭建授权服务器" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>使用Spring Authorization Server搭建授权服务器</h3><p>本节我们将使用<a target="_blank" rel="noopener noreferrer" href="https://spring.io/projects/spring-authorization-server">Spring Authorization Server</a>搭建一个授权服务器，并注册一个客户端使之支持PKCE。</p><h4 id="maven"><a href="#maven" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>maven</h4><div class="relative"><pre><code class="code-highlight language-xml"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-oauth2-authorization-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div><h4 id="配置"><a href="#配置" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>配置</h4><p>首先很简单，我们将创建application.yml文件，并指定授权服务器端口为8080：</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">server</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span></code></pre></div><br/><p>之后我们将创建一个<code>OAuth2ServerConfig</code>配置类，并在此类中我们将创建OAuth2授权服务所需特定Bean：</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token punctuation annotation">@Bean</span>
</span><span class="code-line"><span class="token punctuation annotation">@Order</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">authorizationServerSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token class-name">OAuth2AuthorizationServerConfiguration</span><span class="token punctuation">.</span><span class="token function">applyDefaultSecurity</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exceptions <span class="token operator">-&gt;</span> exceptions<span class="token punctuation">.</span>
</span><span class="code-line">                                <span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginUrlAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation annotation">@Bean</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">RegisteredClientRepository</span> <span class="token function">registeredClientRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token class-name">RegisteredClient</span> registeredClient <span class="token operator">=</span> <span class="token class-name">RegisteredClient</span><span class="token punctuation">.</span><span class="token function">withId</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">clientId</span><span class="token punctuation">(</span><span class="token string">&quot;relive-client&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">clientAuthenticationMethods</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ClientAuthenticationMethod</span><span class="token punctuation">.</span><span class="token constant">NONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//客户端认证模式为none</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">authorizationGrantType</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationGrantType</span><span class="token punctuation">.</span><span class="token constant">AUTHORIZATION_CODE</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">redirectUri</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8070/login/oauth2/code/messaging-client-pkce&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token string">&quot;message.read&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">clientSettings</span><span class="token punctuation">(</span><span class="token class-name">ClientSettings</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token punctuation">.</span><span class="token function">requireAuthorizationConsent</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</span><span class="code-line">                    <span class="token punctuation">.</span><span class="token function">requireProofKey</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">//仅支持PKCE</span>
</span><span class="code-line">                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">tokenSettings</span><span class="token punctuation">(</span><span class="token class-name">TokenSettings</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                   <span class="token punctuation">.</span><span class="token function">accessTokenFormat</span><span class="token punctuation">(</span><span class="token class-name">OAuth2TokenFormat</span><span class="token punctuation">.</span><span class="token constant">SELF_CONTAINED</span><span class="token punctuation">)</span> <span class="token comment">// 生成JWT令牌</span>
</span><span class="code-line">                   <span class="token punctuation">.</span><span class="token function">idTokenSignatureAlgorithm</span><span class="token punctuation">(</span><span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span><span class="token constant">RS256</span><span class="token punctuation">)</span>
</span><span class="code-line">                   <span class="token punctuation">.</span><span class="token function">accessTokenTimeToLive</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                   <span class="token punctuation">.</span><span class="token function">refreshTokenTimeToLive</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                   <span class="token punctuation">.</span><span class="token function">reuseRefreshTokens</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</span><span class="code-line">                   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryRegisteredClientRepository</span><span class="token punctuation">(</span>registeredClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation annotation">@Bean</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">ProviderSettings</span> <span class="token function">providerSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token class-name">ProviderSettings</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">issuer</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8080&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation annotation">@Bean</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">JWKSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityContext</span><span class="token punctuation">&gt;</span></span> <span class="token function">jwkSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token class-name">RSAKey</span> rsaKey <span class="token operator">=</span> <span class="token class-name">Jwks</span><span class="token punctuation">.</span><span class="token function">generateRsa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token class-name">JWKSet</span> jwkSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JWKSet</span><span class="token punctuation">(</span>rsaKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>jwkSelector<span class="token punctuation">,</span> securityContext<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> jwkSelector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>jwkSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Jwks</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">private</span> <span class="token class-name">Jwks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RSAKey</span> <span class="token function">generateRsa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token class-name">KeyGeneratorUtils</span><span class="token punctuation">.</span><span class="token function">generateRsaKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">RSAPublicKey</span> publicKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RSAPublicKey</span><span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">RSAPrivateKey</span> privateKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RSAPrivateKey</span><span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RSAKey<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">.</span><span class="token function">privateKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">.</span><span class="token function">keyID</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">KeyGeneratorUtils</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">private</span> <span class="token class-name">KeyGeneratorUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">static</span> <span class="token class-name">KeyPair</span> <span class="token function">generateRsaKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">KeyPair</span> keyPair<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token class-name">KeyPairGenerator</span> keyPairGenerator <span class="token operator">=</span> <span class="token class-name">KeyPairGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;RSA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">return</span> keyPair<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><strong>请注意</strong>在创建<em>RegisteredClient</em>注册客户端类中，1.我们没有定义<code>client_secret</code>;2.客户端认证模式指定为none；3.requireProofKey()设置为true，此客户端仅支持PKCE。</p><p>其余配置我这里就不一一说明，可以参考<a target="_blank" rel="noopener noreferrer" href="https://relive27.github.io/blog/spring-security-oauth2-jwt">之前文章</a>。</p><br/><p>接下来，我们创建一个Spring Security的配置类，指定Form表单认证和设置用户名密码：</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token punctuation annotation">@Configuration</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">SecurityFilterChain</span> <span class="token function">defaultSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">        http
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>authorizeRequests <span class="token operator">-&gt;</span>
</span><span class="code-line">                        authorizeRequests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">UserDetailsService</span> <span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">PasswordEncoderFactories</span><span class="token punctuation">.</span><span class="token function">createDelegatingPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code></pre></div><p>至此我们就已经配置好了一个简单的授权服务器。</p><h3 id="oauth2客户端"><a href="#oauth2客户端" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>OAuth2客户端</h3><p>本节中我们使用<a target="_blank" rel="noopener noreferrer" href="https://docs.spring.io/spring-security/reference/servlet/oauth2/client/index.html">Spring Security</a>创建一个客户端，此客户端通过PKCE授权码流向授权服务器请求授权，并将获取的access_token发送到资源服务。</p><h4 id="maven-1"><a href="#maven-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>maven</h4><div class="relative"><pre><code class="code-highlight language-xml"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webflux<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.projectreactor.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>reactor-netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span></code></pre></div><h4 id="配置-1"><a href="#配置-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>配置</h4><p>首先我们将在application.yml中配置客户端信息，并指定服务端口号为8070：</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">server</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">port</span><span class="token punctuation">:</span> <span class="token number">8070</span>
</span><span class="code-line">  <span class="token atrule key">servlet</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">session</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">cookie</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">name</span><span class="token punctuation">:</span> CLIENT<span class="token punctuation">-</span>SESSION
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">spring</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">security</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">oauth2</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">client</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">registration</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">messaging-client-pkce</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">provider</span><span class="token punctuation">:</span> client<span class="token punctuation">-</span>provider
</span><span class="code-line">            <span class="token atrule key">client-id</span><span class="token punctuation">:</span> relive<span class="token punctuation">-</span>client
</span><span class="code-line">            <span class="token atrule key">client-secret</span><span class="token punctuation">:</span> relive<span class="token punctuation">-</span>client
</span><span class="code-line">            <span class="token atrule key">authorization-grant-type</span><span class="token punctuation">:</span> authorization_code
</span><span class="code-line">            <span class="token atrule key">client-authentication-method</span><span class="token punctuation">:</span> none
</span><span class="code-line">            <span class="token atrule key">redirect-uri</span><span class="token punctuation">:</span> <span class="token string">&quot;http://127.0.0.1:8070/login/oauth2/code/{registrationId}&quot;</span>
</span><span class="code-line">            <span class="token atrule key">scope</span><span class="token punctuation">:</span> message.read
</span><span class="code-line">            <span class="token atrule key">client-name</span><span class="token punctuation">:</span> messaging<span class="token punctuation">-</span>client<span class="token punctuation">-</span>pkce
</span><span class="code-line">        <span class="token atrule key">provider</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">client-provider</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">authorization-uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>8080/oauth2/authorize
</span><span class="code-line">            <span class="token atrule key">token-uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>8080/oauth2/token
</span><span class="code-line">
</span></code></pre></div><br/><p>接下来，我们创建Spring Security配置类，启用OAuth2客户端。</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token punctuation annotation">@Configuration</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">        http
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>authorizeRequests <span class="token operator">-&gt;</span>
</span><span class="code-line">                        <span class="token comment">//便于测试，将权限开放</span>
</span><span class="code-line">                        authorizeRequests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">oauth2Client</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">WebClient</span> <span class="token function">webClient</span><span class="token punctuation">(</span><span class="token class-name">OAuth2AuthorizedClientManager</span> authorizedClientManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">ServletOAuth2AuthorizedClientExchangeFilterFunction</span> oauth2Client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletOAuth2AuthorizedClientExchangeFilterFunction</span><span class="token punctuation">(</span>authorizedClientManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>oauth2Client<span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token class-name">OAuth2AuthorizedClientManager</span> <span class="token function">authorizedClientManager</span><span class="token punctuation">(</span><span class="token class-name">ClientRegistrationRepository</span> clientRegistrationRepository<span class="token punctuation">,</span>
</span><span class="code-line">                                                          <span class="token class-name">OAuth2AuthorizedClientRepository</span> authorizedClientRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">OAuth2AuthorizedClientProvider</span> authorizedClientProvider <span class="token operator">=</span> <span class="token class-name">OAuth2AuthorizedClientProviderBuilder</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">authorizationCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">refreshToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">DefaultOAuth2AuthorizedClientManager</span> authorizedClientManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultOAuth2AuthorizedClientManager</span><span class="token punctuation">(</span>clientRegistrationRepository<span class="token punctuation">,</span> authorizedClientRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        authorizedClientManager<span class="token punctuation">.</span><span class="token function">setAuthorizedClientProvider</span><span class="token punctuation">(</span>authorizedClientProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">return</span> authorizedClientManager<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code></pre></div><p>上述配置类中我们通过<em>oauth2Client(withDefaults())<em>启用OAuth2客户端。并创建一个WebClient实例用于向资源服务器执行HTTP请求。<code>OAuth2AuthorizedClientManager</code>这是协调OAuth2授权码请求的高级控制器类，不过授权码流程并不是由它控制，可以查看它所管理的</em>Provider</em>实现类<em>AuthorizationCodeOAuth2AuthorizedClientProvider</em>中并没有涉及相关授权码流程代码逻辑，对于Spring Security授权码模式涉及核心接口流程我会放在之后的文章统一介绍。回到<em>OAuth2AuthorizedClientManager</em>类中，我们可以看到同时还指定了<em>refreshToken()</em>,它实现了刷新token逻辑，将在请求资源服务过程中access_token过期后将刷新token，前提是refresh_token没有过期，否则你将重新执行OAuth2授权码流程。</p><br/><p>接下来，我们创建一个Controller类，使用WebClient请求资源服务：</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token punctuation annotation">@RestController</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PkceClientController</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Autowired</span>
</span><span class="code-line">    <span class="token keyword">private</span> <span class="token class-name">WebClient</span> webClient<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/client/test&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">List</span> <span class="token function">getArticles</span><span class="token punctuation">(</span><span class="token punctuation annotation">@RegisteredOAuth2AuthorizedClient</span><span class="token punctuation">(</span><span class="token string">&quot;messaging-client-pkce&quot;</span><span class="token punctuation">)</span> <span class="token class-name">OAuth2AuthorizedClient</span> authorizedClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webClient
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8090/resource/article&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">attributes</span><span class="token punctuation">(</span><span class="token function">oauth2AuthorizedClient</span><span class="token punctuation">(</span>authorizedClient<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="资源服务器"><a href="#资源服务器" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>资源服务器</h3><p>本节中，我们将使用Spring Security搭建一个资源服务器。</p><h3 id="maven-2"><a href="#maven-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>maven</h3><div class="relative"><pre><code class="code-highlight language-xml"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-resource-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div><h4 id="配置-2"><a href="#配置-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>配置</h4><p>通过application.yml配置资源服务器服务端口8070，并指定授权服务器jwk uri，用于获取公钥信息验证token令牌：</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">server</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">port</span><span class="token punctuation">:</span> <span class="token number">8090</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">spring</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">security</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">oauth2</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">resourceserver</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">jwt</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">jwk-set-uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>8080/oauth2/jwks
</span></code></pre></div><p>接下来配置Spring Security配置类，指定受保护端点访问权限：</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token punctuation annotation">@Configuration</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@Bean</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">defaultSecurityFilter</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
</span><span class="code-line">        http<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/resource/article&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>authorize<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> authorize
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/resource/article&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;SCOPE_message.read&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                        <span class="token punctuation">.</span><span class="token function">mvcMatchers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">.</span><span class="token function">oauth2ResourceServer</span><span class="token punctuation">(</span><span class="token class-name">OAuth2ResourceServerConfigurer</span><span class="token operator">::</span><span class="token function">jwt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>上述配置类中指定/resource/article必须拥有message.read权限才能访问，并配置资源服务使用JWT身份验证。</p><br/><p>之后我们将创建Controller类，作为受保护端点：</p><div class="relative"><pre><code class="code-highlight language-java"><span class="code-line"><span class="token punctuation annotation">@RestController</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleRestController</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token punctuation annotation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/resource/article&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">article</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;article1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;article2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;article3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="访问资源列表"><a href="#访问资源列表" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>访问资源列表</h3><p>启动所有服务后，在浏览器中输入 <a target="_blank" rel="noopener noreferrer" href="http://127.0.0.1:8070/client/test">http://127.0.0.1:8070/client/test</a> ，通过授权服务器认证后，您将在页面中看到以下输出信息：</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">[</span><span class="token string">&quot;article1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;article2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;article3&quot;</span><span class="token punctuation">]</span>
</span></code></pre></div><h3 id="结论"><a href="#结论" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>结论</h3><p>在Spring Security目前版本中保密客户端的 PKCE 已经成为默认行为。在保密客户端授权码模式中同样可以使用PKCE。</p><p>与往常一样，本文中使用的源代码可<a target="_blank" rel="noopener noreferrer" href="https://github.com/ReLive27/spring-security-oauth2-sample/tree/main/oauth2-pkce">在 GitHub 上</a>获得。</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=%2Fblog%2Foauth2-pkce">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/ReLive27/relive27.com/blob/master/data/blog/oauth2-pkce.mdx">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/oauth2">OAuth2</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/springsecurity">SpringSecurity</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/oauth2-client-model">Spring Security OAuth2客户端凭据授权</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/oauth2-login">Spring Security OAuth2登录</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:re_live27@163.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" role="img" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/ReLive27"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/4051073081555869"><span class="sr-only">juejin</span><svg class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" role="img"><path d="M465.189 161.792c-22.967 18.14-44.325 35.109-47.397 37.742l-5.851 4.68 10.971 8.632c5.998 4.827 11.85 9.508 13.02 10.532 1.17 1.024 17.993 14.336 37.156 29.696l34.962 27.795 5.267-3.95c2.925-2.194 23.259-18.432 45.348-35.986 21.943-17.555 41.253-32.768 42.716-33.646 1.609-1.024 2.779-2.194 2.779-2.78 0-.438-9.655-8.63-21.504-17.846-11.995-9.363-22.674-17.847-23.845-18.871-15.945-13.02-49.737-39.059-50.76-39.059-.586.147-19.896 14.922-42.862 33.061zm233.325 180.37C507.465 493.275 508.928 492.105 505.417 489.911c-3.072-1.902-11.556-8.485-64.073-50.03-9.07-7.168-18.578-14.775-21.358-16.823-2.78-2.194-8.777-6.875-13.312-10.532-4.68-3.657-10.679-8.339-13.312-10.533-13.165-10.24-71.095-56.027-102.107-80.457-5.852-4.681-11.41-8.485-12.142-8.485-.731 0-10.971 7.754-22.674 17.116-11.703 9.508-22.674 18.286-24.284 19.456-1.755 1.17-5.12 3.95-7.46 6.144-2.34 2.34-4.828 4.096-5.413 4.096-3.072 0-.731 3.072 6.437 8.777 4.096 3.218 8.777 6.875 10.094 8.046 1.316 1.024 10.24 8.045 19.748 15.506s23.26 18.286 30.428 23.99c19.31 15.215 31.89 25.308 127.853 101.084 47.836 37.742 88.796 69.779 90.844 71.095 3.657 2.487 3.95 2.487 7.46-.292a1041.42 1041.42 0 0 0 16.092-12.727c6.875-5.413 14.775-11.703 17.554-13.897 30.135-23.699 80.018-63.05 81.774-64.512 1.17-1.024 12.434-9.802 24.868-19.603s37.888-29.696 56.32-44.324c18.579-14.629 46.227-36.425 61.733-48.567 15.506-12.142 27.794-22.528 27.502-23.26-.878-1.17-57.637-47.104-59.978-48.274-.731-.439-18.578 12.727-39.497 29.257z"></path><path d="M57.93 489.326c-15.215 12.288-28.527 23.405-29.697 24.576-2.34 2.194-5.412-.44 80.018 66.852 33.207 26.185 32.622 25.747 57.637 45.495 10.386 8.192 36.279 28.672 57.783 45.495 38.18 30.135 44.91 35.401 52.663 41.545 2.048 1.756 22.967 18.14 46.372 36.572 23.26 18.432 74.167 58.514 112.933 89.088 38.912 30.573 71.095 55.734 71.826 56.027.732.293 7.46-4.389 14.921-10.386 21.797-16.97 90.259-70.949 101.523-79.872 5.705-4.535 12.873-10.24 15.945-12.58 3.072-2.488 6.436-5.12 7.314-5.852.878-.878 11.85-9.509 24.283-19.31 20.773-16.091 59.1-46.226 64.366-50.615 1.17-1.024 5.12-4.096 8.777-6.875 3.657-2.78 7.9-6.29 9.509-7.607 1.609-1.317 14.775-11.703 29.257-23.113 29.11-22.82 42.277-33.207 88.503-69.632 17.262-13.605 32.475-25.454 33.646-26.478 2.486-2.048 31.451-24.869 44.617-35.255 4.827-3.657 9.07-7.168 9.508-7.607.44-.585 5.998-4.827 12.435-9.8 6.436-4.828 13.165-10.24 15.067-11.85l3.365-2.926-9.948-7.753c-5.412-4.388-10.24-8.192-10.679-8.63-1.17-1.317-22.381-18.433-30.135-24.284-3.95-3.072-7.314-5.998-7.606-6.73-1.317-3.071-6.73.147-29.258 17.994-13.458 10.532-25.746 20.187-27.355 21.504-1.61 1.463-10.533 8.338-19.749 15.652-9.216 7.168-17.115 13.459-17.554 13.898-.439.438-6.583 5.412-13.897 10.971-7.168 5.559-15.214 11.703-17.7 13.75-4.974 4.097-5.413 4.39-20.334 16.239-5.56 4.388-11.264 8.777-12.435 9.8-1.17 1.025-20.333 16.092-42.422 33.354-22.09 17.408-41.546 32.768-43.155 34.084-1.609 1.463-14.482 11.557-28.525 22.528s-40.814 32.037-59.539 46.812c-18.578 14.775-42.276 33.353-52.516 41.399s-23.26 18.285-28.965 22.82l-10.386 8.339-4.389-3.072c-2.34-1.756-4.68-3.511-5.12-3.95-.439-.439-4.973-4.096-10.24-8.046-11.849-9.216-14.482-11.264-16.676-13.166-.878-.877-4.243-3.51-7.46-5.851-3.22-2.487-6.145-4.681-6.584-5.12-.439-.439-6.875-5.705-14.482-11.703-7.607-5.851-14.921-11.556-16.091-12.58-1.317-1.17-17.116-13.605-35.255-27.795-17.993-14.19-35.109-27.648-38.035-29.842-5.705-4.681-33.499-26.624-125.074-98.743-34.523-27.209-72.704-57.344-84.846-66.852-49.737-39.498-55.15-43.594-56.905-43.447-.877 0-14.043 10.24-29.257 22.528z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://blog.csdn.net/new_ord?spm=1000.2115.3001.5343"><span class="sr-only">csdn</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M13.36 13.974c.138.03.32.059.678.059 1.435 0 2.447-.779 2.548-1.874.148-1.583-.75-2.137-2.262-2.127-.196 0-.468 0-.612.029l-.352 3.913z" opacity="0.3"></path><path d="M6.217 13.408c.447.18 1.379.359 2.132.359.812 0 1.264-.247 1.3-.632.033-.35-.299-.398-1.216-.637-1.267-.342-2.075-.871-1.996-1.717.092-.982 1.286-1.724 3.118-1.724.893 0 1.759.069 2.208.231l-.154 1.238c-.291-.112-1.406-.266-2.16-.266-.765 0-1.16.265-1.188.555-.034.367.363.385 1.356.676 1.345.376 1.933.905 1.856 1.725-.091.964-1.165 1.784-3.31 1.784-.893 0-1.663-.179-2.087-.359l.141-1.233zM18.821 9.366c4.884-1.017 5.305.811 5.154 2.428l-.284 2.992h-1.55l.259-2.729c.056-.601.405-1.776-1.281-1.732-.584.016-.873.104-.873.104s-.051.726-.112 1.263l-.294 3.095h-1.52l.302-3.05.199-2.371zM12.653 9.224c.349-.042.884-.084 1.621-.084 1.23 0 2.225.236 2.841.734.553.464.921 1.214.819 2.302-.094 1.012-.57 1.721-1.264 2.159-.635.413-1.434.59-2.637.59-.709 0-1.385-.042-1.9-.126l.52-5.575zm1.016 4.466a2.6 2.6 0 0 0 .582.051c1.231 0 2.098-.668 2.185-1.607.127-1.358-.643-1.832-1.94-1.824-.168 0-.401 0-.525.025l-.302 3.355zM5.335 14.813c-.292.111-.896.187-1.74.187-2.427 0-3.737-1.254-3.583-2.913C.198 10.112 2.139 9 4.264 9c.823 0 1.308.073 1.762.195l-.146 1.331c-.302-.112-1.01-.215-1.583-.215-1.25 0-2.312.41-2.434 1.707-.109 1.16.637 1.714 2.044 1.714.49 0 1.212-.077 1.545-.189l-.117 1.27z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://blog.csdn.net/new_ord?spm=1000.2115.3001.5343"><span class="sr-only">jianshu</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M6 1c0 1.082-.693 3.753-4 5v2a9.54 9.54 0 0 0 2.146-.793C4.79 8.127 5 9.434 5 10h2c0-.835-.411-1.982-1-3H4.525A6.952 6.952 0 0 0 6.73 5h.476C7.67 5.732 8 6.653 8 7h2c0-.568-.2-1.282-.508-2H12V3H7.687C7.905 2.27 8 1.573 8 1H6zm10 0c0 1.082-.693 3.753-4 5v2c2.36-.572 3.831-1.725 4.729-3h.476c.465.732.795 1.653.795 2h2c0-.568-.2-1.282-.508-2H22V3h-4.313c.218-.73.313-1.427.313-2h-2zm-4 7H8v2h10v9c0 .565-.435 1-1 1h-2v2h2c1.645 0 3-1.355 3-3V8h-8zm-8 3v11h2V11H4zm4 1v8h5c1.645 0 3-1.355 3-3v-5H8zm2 2h4v1h-4v-1zm0 3h4c0 .565-.435 1-1 1h-3v-1z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>© 2022</div><div> • </div><a href="/">ReLive27</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=e=\u003el(e,\"__esModule\",{value:!0});var m=(e,s)=\u003e()=\u003e(s||e((s={exports:{}}).exports,s),s.exports),N=(e,s)=\u003e{t(e);for(var c in s)l(e,c,{get:s[c],enumerable:!0})},k=(e,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let a of d(s))!u.call(e,a)\u0026\u0026a!==\"default\"\u0026\u0026l(e,a,{get:()=\u003es[a],enumerable:!(c=p(s,a))||c.enumerable});return e},g=e=\u003ek(t(l(e!=null?r(h(e)):{},\"default\",e\u0026\u0026e.__esModule\u0026\u0026\"default\"in e?{get:()=\u003ee.default,enumerable:!0}:{value:e,enumerable:!0})),e);var o=m((C,i)=\u003e{i.exports=_jsx_runtime});var b={};N(b,{default:()=\u003ew,frontmatter:()=\u003ey});var n=g(o()),y={title:\"Spring Security OAuth2 \\u5E26\\u6709\\u7528\\u4E8E\\u4EE3\\u7801\\u4EA4\\u6362\\u7684\\u8BC1\\u660E\\u5BC6\\u94A5 (PKCE) \\u7684\\u6388\\u6743\\u7801\\u6D41\",date:new Date(165806051e4),tags:[\"OAuth2\",\"SpringSecurity\"],draft:!1,authors:[\"default\"]};function f(e={}){let{wrapper:s}=e.components||{};return s?(0,n.jsx)(s,Object.assign({},e,{children:(0,n.jsx)(c,{})})):c();function c(){let a=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",img:\"img\",h3:\"h3\",strong:\"strong\",ol:\"ol\",li:\"li\",h4:\"h4\",pre:\"pre\",code:\"code\",em:\"em\"},e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a.h2,{id:\"spring-security-oauth2-\\u5E26\\u6709\\u7528\\u4E8E\\u4EE3\\u7801\\u4EA4\\u6362\\u7684\\u8BC1\\u660E\\u5BC6\\u94A5-pkce-\\u7684\\u6388\\u6743\\u7801\\u6D41\",children:[(0,n.jsx)(a.a,{href:\"#spring-security-oauth2-\\u5E26\\u6709\\u7528\\u4E8E\\u4EE3\\u7801\\u4EA4\\u6362\\u7684\\u8BC1\\u660E\\u5BC6\\u94A5-pkce-\\u7684\\u6388\\u6743\\u7801\\u6D41\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Spring Security OAuth2 \\u5E26\\u6709\\u7528\\u4E8E\\u4EE3\\u7801\\u4EA4\\u6362\\u7684\\u8BC1\\u660E\\u5BC6\\u94A5 (PKCE) \\u7684\\u6388\\u6743\\u7801\\u6D41\"]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.img,{alt:\"\",src:\"../static/images/blogs/oauth2.png\"})}),(0,n.jsxs)(a.h3,{id:\"\\u6982\\u8FF0\",children:[(0,n.jsx)(a.a,{href:\"#\\u6982\\u8FF0\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u6982\\u8FF0\"]}),(0,n.jsxs)(a.p,{children:[\"OAuth2\\u4F9D\\u636E\\u662F\\u5426\\u80FD\\u6301\\u6709\\u5BA2\\u6237\\u7AEF\\u5BC6\\u94A5\\uFF0C\\u5C06\\u5BA2\\u6237\\u7AEF\\u5206\\u4E3A\\u4E24\\u79CD\\u7C7B\\u578B\\uFF1A\",(0,n.jsx)(a.strong,{children:\"\\u516C\\u5171\\u5BA2\\u6237\\u7AEF\"}),\"\\u548C\",(0,n.jsx)(a.strong,{children:\"\\u4FDD\\u5BC6\\u5BA2\\u6237\\u7AEF\"}),\"\\u3002\"]}),(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:\"\\u4FDD\\u5BC6\\u5BA2\\u6237\\u7AEF\"}),\"\\u5728\\u670D\\u52A1\\u5668\\u4E0A\\u8FD0\\u884C\\uFF0C\\u5728\\u524D\\u9762\\u4ECB\\u7ECDOAuth2\\u6587\\u7AE0\\u4E2DSpring Boot\\u521B\\u5EFA\\u7684\\u5E94\\u7528\\u7A0B\\u5E8F\\u662F\\u4FDD\\u5BC6\\u5BA2\\u6237\\u7AEF\\u7C7B\\u578B\\u7684\\u793A\\u4F8B\\u3002\\u9996\\u5148\\u5B83\\u4EEC\\u5728\\u670D\\u52A1\\u5668\\u4E0A\\u8FD0\\u884C\\uFF0C\\u5E76\\u4E14\\u901A\\u5E38\\u4F4D\\u4E8E\\u5177\\u6709\\u5176\\u4ED6\\u4FDD\\u62A4\\u63AA\\u65BD\\u9632\\u706B\\u5899\\u6216\\u7F51\\u5173\\u7684\\u540E\\u9762\\u3002\"]}),(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:\"\\u516C\\u5171\\u5BA2\\u6237\\u7AEF\"}),\"\\u7684\\u4EE3\\u7801\\u4E00\\u822C\\u4F1A\\u4EE5\\u67D0\\u79CD\\u5F62\\u5F0F\\u66B4\\u9732\\u7ED9\\u6700\\u7EC8\\u7528\\u6237\\uFF0C\\u8981\\u4E48\\u662F\\u5728\\u6D4F\\u89C8\\u5668\\u4E2D\\u4E0B\\u8F7D\\u6267\\u884C\\uFF0C\\u8981\\u4E48\\u662F\\u76F4\\u63A5\\u5728\\u7528\\u6237\\u7684\\u8BBE\\u5907\\u4E0A\\u8FD0\\u884C\\u3002\\u4F8B\\u5982\",(0,n.jsx)(a.strong,{children:\"\\u539F\\u751F\\u5E94\\u7528\"}),\"\\u662F\\u76F4\\u63A5\\u5728\\u6700\\u7EC8\\u7528\\u6237\\u7684\\u8BBE\\u5907\\uFF08\\u8BA1\\u7B97\\u673A\\u6216\\u8005\\u79FB\\u52A8\\u8BBE\\u5907\\uFF09\\u4E0A\\u8FD0\\u884C\\u7684\\u5E94\\u7528\\u3002\\u8FD9\\u7C7B\\u5E94\\u7528\\u5728\\u4F7F\\u7528OAuth2\\u534F\\u8BAE\\u65F6\\uFF0C\\u6211\\u4EEC\\u65E0\\u6CD5\\u4FDD\\u8BC1\\u4E3A\\u6B64\\u5E94\\u7528\\u9881\\u53D1\\u7684\\u5BA2\\u6237\\u7AEF\\u5BC6\\u94A5\\u80FD\\u5B89\\u5168\\u7684\\u5B58\\u50A8\\uFF0C\\u56E0\\u4E3A\\u8FD9\\u4E9B\\u5E94\\u7528\\u7A0B\\u5E8F\\u5728\\u8FD0\\u884C\\u4E4B\\u524D\\u4F1A\\u5B8C\\u5168\\u4E0B\\u8F7D\\u5230\\u8BBE\\u5907\\u4E0A\\uFF0C\\u53CD\\u7F16\\u8BD1\\u5E94\\u7528\\u7A0B\\u5E8F\\u5C06\\u5B8C\\u5168\\u663E\\u793A\\u5BA2\\u6237\\u7AEF\\u5BC6\\u94A5\\u3002\"]}),(0,n.jsxs)(a.p,{children:[\"\\u540C\\u6837\\u5B58\\u5728\\u6B64\\u5B89\\u5168\\u95EE\\u9898\\u8FD8\\u6709\",(0,n.jsx)(a.strong,{children:\"\\u5355\\u9875\\u5E94\\u7528\"}),\"\\uFF08SPA\\uFF09\\uFF0C\\u6D4F\\u89C8\\u5668\\u672C\\u8EAB\\u662F\\u4E00\\u4E2A\\u4E0D\\u5B89\\u5168\\u7684\\u73AF\\u5883\\uFF0C\\u4E00\\u65E6\\u4F60\\u52A0\\u8F7DJavaScript\\u5E94\\u7528\\u7A0B\\u5E8F\\uFF0C\\u6D4F\\u89C8\\u5668\\u5C06\\u4F1A\\u4E0B\\u8F7D\\u6574\\u4E2A\\u6E90\\u4EE3\\u7801\\u4EE5\\u4FBF\\u8FD0\\u884C\\u5B83\\uFF0C\\u6574\\u4E2A\\u6E90\\u4EE3\\u7801\\uFF0C\\u5305\\u62EC\\u5176\\u4E2D\\u7684\\u4EFB\\u4F55 \\u5BA2\\u6237\\u7AEF\\u5BC6\\u94A5\\uFF0C\\u90FD\\u5C06\\u53EF\\u89C1\\u3002\\u5982\\u679C\\u4F60\\u6784\\u5EFA\\u4E00\\u4E2A\\u62E5\\u6709100000\\u540D\\u7528\\u6237\\u7684\\u5E94\\u7528\\u7A0B\\u5E8F\\uFF0C\\u90A3\\u4E48\\u5F88\\u53EF\\u80FD\\u8FD9\\u4E9B\\u7528\\u6237\\u4E2D\\u7684\\u4E00\\u90E8\\u5206\\u5C06\\u611F\\u67D3\\u6076\\u610F\\u8F6F\\u4EF6\\u6216\\u75C5\\u6BD2\\uFF0C\\u5E76\\u6CC4\\u6F0F\\u5BA2\\u6237\\u7AEF\\u5BC6\\u94A5\\u3002\"]}),(0,n.jsx)(a.p,{children:\"\\u4F60\\u53EF\\u80FD\\u4F1A\\u60F3\\uFF0C\\u201C\\u5982\\u679C\\u6211\\u901A\\u8FC7\\u5C06\\u5BA2\\u6237\\u7AEF\\u5BC6\\u94A5\\u62C6\\u5206\\u4E3A\\u51E0\\u4E2A\\u90E8\\u5206\\u8FDB\\u884C\\u6DF7\\u6DC6\\u5462\\uFF1F\\u201D\\u8FD9\\u4E0D\\u53EF\\u5426\\u8BA4\\u4F1A\\u4E3A\\u4F60\\u4E89\\u53D6\\u70B9\\u65F6\\u95F4\\uFF0C\\u4F46\\u771F\\u6B63\\u6709\\u51B3\\u5FC3\\u7684\\u4EBA\\u4ECD\\u53EF\\u80FD\\u4F1A\\u5F04\\u6E05\\u695A\\u3002\"}),(0,n.jsx)(a.p,{children:\"\\u4E3A\\u4E86\\u89C4\\u907F\\u8FD9\\u79CD\\u5B89\\u5168\\u98CE\\u9669\\uFF0C\\u6700\\u597D\\u4F7F\\u7528\\u4EE3\\u7801\\u4EA4\\u6362\\u8BC1\\u660E\\u5BC6\\u94A5(PKCE)\\u3002\"}),(0,n.jsxs)(a.h3,{id:\"proof-key-for-code-exchange\",children:[(0,n.jsx)(a.a,{href:\"#proof-key-for-code-exchange\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Proof Key for Code Exchange\"]}),(0,n.jsxs)(a.p,{children:[\"PKCE \\u6709\\u81EA\\u5DF1\\u72EC\\u7ACB\\u7684\",(0,n.jsx)(a.a,{href:\"https://tools.ietf.org/html/rfc7636\",children:\"\\u89C4\\u8303\"}),\"\\u3002\\u5B83\\u4F7F\\u5E94\\u7528\\u7A0B\\u5E8F\\u80FD\\u591F\\u5728\\u516C\\u5171\\u5BA2\\u6237\\u7AEF\\u4E2D\\u4F7F\\u7528\\u6388\\u6743\\u7801\\u6D41\\u7A0B\\u3002\"]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.img,{alt:\"\",src:\"../static/images/blogs/PKCE.drawio.png\"})}),(0,n.jsxs)(a.ol,{children:[(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u7528\\u6237\\u5728\\u5BA2\\u6237\\u7AEF\\u8BF7\\u6C42\\u8D44\\u6E90\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u5BA2\\u6237\\u7AEF\\u521B\\u5EFA\\u5E76\\u8BB0\\u5F55\\u540D\\u4E3A code_verifier \\u7684\\u79D8\\u5BC6\\u4FE1\\u606F\\uFF0C\\u7136\\u540E\\u5BA2\\u6237\\u7AEF\\u6839\\u636E code_verifier \\u8BA1\\u7B97\\u51FA code_challenge\\uFF0C\\u5B83\\u7684\\u503C\\u53EF\\u4EE5\\u662F code_verifier\\uFF0C\\u4E5F\\u53EF\\u4EE5\\u662F code_verifier \\u7684 SHA-256 \\u6563\\u5217\\uFF0C\\u4F46\\u662F\\u5E94\\u8BE5\\u4F18\\u5148\\u8003\\u8651\\u4F7F\\u7528\\u5BC6\\u7801\\u6563\\u5217\\uFF0C\\u56E0\\u4E3A\\u5B83\\u80FD\\u9632\\u6B62\\u9A8C\\u8BC1\\u5668\\u672C\\u8EAB\\u906D\\u5230\\u622A\\u83B7\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u5BA2\\u6237\\u7AEF\\u5C06 code_challenge \\u4EE5\\u53CA\\u53EF\\u9009\\u7684 code_challenge_method(\\u4E00\\u4E2A\\u5173\\u952E\\u5B57\\uFF0C\\u8868 \\u793A\\u539F\\u6587\\u6216\\u8005 SHA-256 \\u6563\\u5217)\\u4E0E\\u5E38\\u89C4\\u7684\\u6388\\u6743\\u8BF7\\u6C42\\u53C2\\u6570\\u4E00\\u8D77\\u53D1\\u9001\\u7ED9\\u6388\\u6743\\u670D\\u52A1\\u5668\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u6388\\u6743\\u670D\\u52A1\\u5668\\u5C06\\u7528\\u6237\\u91CD\\u5B9A\\u5411\\u5230\\u767B\\u5F55\\u9875\\u9762\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u7528\\u6237\\u4F7F\\u8FDB\\u884C\\u8EAB\\u4EFD\\u9A8C\\u8BC1\\uFF0C\\u5E76\\u4E14\\u53EF\\u80FD\\u4F1A\\u770B\\u5230\\u4E00\\u4E2A\\u540C\\u610F\\u9875\\u9762\\uFF0C\\u5176\\u4E2D\\u5217\\u51FA\\u4E86 \\u6388\\u6743\\u670D\\u52A1\\u5668\\u5C06\\u6388\\u4E88\\u5BA2\\u6237\\u7AEF\\u7684\\u6743\\u9650\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u6388\\u6743\\u670D\\u52A1\\u5668\\u5C06 code_challenge \\u548C code_challenge_method(\\u5982\\u679C\\u6709 \\u7684\\u8BDD)\\u8BB0\\u5F55\\u4E0B\\u6765\\u3002\\u6388\\u6743\\u670D\\u52A1\\u5668\\u4F1A\\u5C06\\u8FD9\\u4E9B\\u4FE1\\u606F\\u4E0E\\u9881\\u53D1\\u7684\\u6388\\u6743\\u7801\\u5173\\u8054\\u8D77\\u6765\\uFF0C\\u5E76\\u643A\\u5E26code\\u91CD\\u5B9A\\u5411\\u56DE\\u5BA2\\u6237\\u7AEF\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u5BA2\\u6237\\u7AEF\\u63A5\\u6536\\u5230\\u6388\\u6743\\u7801\\u4E4B\\u540E\\uFF0C\\u643A\\u5E26\\u4E4B\\u524D\\u751F\\u6210\\u7684 code_verifier \\u6267\\u884C\\u4EE4\\u724C\\u8BF7\\u6C42\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u6388\\u6743\\u670D\\u52A1\\u5668\\u6839\\u636Ecode_verifier\\u8BA1\\u7B97\\u51FA code_challenge\\uFF0C\\u5E76\\u68C0\\u67E5\\u662F\\u5426\\u4E0E\\u6700\\u521D\\u63D0\\u4EA4\\u7684code_challenge\\u4E00\\u81F4\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u6388\\u6743\\u670D\\u52A1\\u5668\\u5411\\u5BA2\\u6237\\u7AEF\\u53D1\\u9001\\u4EE4\\u724C\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u5BA2\\u6237\\u7AEF\\u5411\\u53D7\\u4FDD\\u62A4\\u8D44\\u6E90\\u53D1\\u9001\\u4EE4\\u724C\\u3002\"})}),(0,n.jsx)(a.li,{children:(0,n.jsx)(a.p,{children:\"\\u53D7\\u4FDD\\u62A4\\u8D44\\u6E90\\u5411\\u5BA2\\u6237\\u7AEF\\u8FD4\\u56DE\\u8D44\\u6E90\\u3002\"})})]}),(0,n.jsxs)(a.h3,{id:\"\\u4F7F\\u7528spring-authorization-server\\u642D\\u5EFA\\u6388\\u6743\\u670D\\u52A1\\u5668\",children:[(0,n.jsx)(a.a,{href:\"#\\u4F7F\\u7528spring-authorization-server\\u642D\\u5EFA\\u6388\\u6743\\u670D\\u52A1\\u5668\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u4F7F\\u7528Spring Authorization Server\\u642D\\u5EFA\\u6388\\u6743\\u670D\\u52A1\\u5668\"]}),(0,n.jsxs)(a.p,{children:[\"\\u672C\\u8282\\u6211\\u4EEC\\u5C06\\u4F7F\\u7528\",(0,n.jsx)(a.a,{href:\"https://spring.io/projects/spring-authorization-server\",children:\"Spring Authorization Server\"}),\"\\u642D\\u5EFA\\u4E00\\u4E2A\\u6388\\u6743\\u670D\\u52A1\\u5668\\uFF0C\\u5E76\\u6CE8\\u518C\\u4E00\\u4E2A\\u5BA2\\u6237\\u7AEF\\u4F7F\\u4E4B\\u652F\\u6301PKCE\\u3002\"]}),(0,n.jsxs)(a.h4,{id:\"maven\",children:[(0,n.jsx)(a.a,{href:\"#maven\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"maven\"]}),(0,n.jsx)(a.pre,{className:\"language-xml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-xml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-security\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.security\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-security-oauth2-authorization-server\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"0.3.1\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-web\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})]})}),(0,n.jsxs)(a.h4,{id:\"\\u914D\\u7F6E\",children:[(0,n.jsx)(a.a,{href:\"#\\u914D\\u7F6E\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u914D\\u7F6E\"]}),(0,n.jsx)(a.p,{children:\"\\u9996\\u5148\\u5F88\\u7B80\\u5355\\uFF0C\\u6211\\u4EEC\\u5C06\\u521B\\u5EFAapplication.yml\\u6587\\u4EF6\\uFF0C\\u5E76\\u6307\\u5B9A\\u6388\\u6743\\u670D\\u52A1\\u5668\\u7AEF\\u53E3\\u4E3A8080\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-yaml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"port\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"8080\"}),`\n`]})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsxs)(a.p,{children:[\"\\u4E4B\\u540E\\u6211\\u4EEC\\u5C06\\u521B\\u5EFA\\u4E00\\u4E2A\",(0,n.jsx)(a.code,{children:\"OAuth2ServerConfig\"}),\"\\u914D\\u7F6E\\u7C7B\\uFF0C\\u5E76\\u5728\\u6B64\\u7C7B\\u4E2D\\u6211\\u4EEC\\u5C06\\u521B\\u5EFAOAuth2\\u6388\\u6743\\u670D\\u52A1\\u6240\\u9700\\u7279\\u5B9ABean\\uFF1A\"]}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Order\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Ordered\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"HIGHEST_PRECEDENCE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityFilterChain\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizationServerSecurityFilterChain\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HttpSecurity\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizationServerConfiguration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"applyDefaultSecurity\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"exceptionHandling\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"exceptions \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" exceptions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                                \",(0,n.jsx)(a.span,{className:\"token function\",children:\"authenticationEntryPoint\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"LoginUrlAuthenticationEntryPoint\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"/login\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RegisteredClientRepository\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"registeredClientRepository\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RegisteredClient\"}),\" registeredClient \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RegisteredClient\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"withId\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"UUID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"randomUUID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toString\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"clientId\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"relive-client\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"clientAuthenticationMethods\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"s \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      s\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ClientAuthenticationMethod\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"NONE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),(0,n.jsx)(a.span,{className:\"token comment\",children:\"//\\u5BA2\\u6237\\u7AEF\\u8BA4\\u8BC1\\u6A21\\u5F0F\\u4E3Anone\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizationGrantType\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"AuthorizationGrantType\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"AUTHORIZATION_CODE\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"redirectUri\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"http://127.0.0.1:8070/login/oauth2/code/messaging-client-pkce\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"scope\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"message.read\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"clientSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ClientSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"builder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"requireAuthorizationConsent\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"requireProofKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"//\\u4EC5\\u652F\\u6301PKCE\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"tokenSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"TokenSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"builder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                   \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"accessTokenFormat\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2TokenFormat\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"SELF_CONTAINED\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// \\u751F\\u6210JWT\\u4EE4\\u724C\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                   \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"idTokenSignatureAlgorithm\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SignatureAlgorithm\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"RS256\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                   \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"accessTokenTimeToLive\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Duration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"ofSeconds\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"30\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"60\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                   \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"refreshTokenTimeToLive\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Duration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"ofSeconds\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"60\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"60\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                   \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"reuseRefreshTokens\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                   \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"InMemoryRegisteredClientRepository\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"registeredClient\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ProviderSettings\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"providerSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ProviderSettings\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"builder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"issuer\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"http://127.0.0.1:8080\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JWKSource\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityContext\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"jwkSource\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAKey\"}),\" rsaKey \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Jwks\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"generateRsa\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JWKSet\"}),\" jwkSet \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"JWKSet\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"rsaKey\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"jwkSelector\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" securityContext\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),\" jwkSelector\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"select\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"jwkSet\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Jwks\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Jwks\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAKey\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"generateRsa\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPair\"}),\" keyPair \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyGeneratorUtils\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"generateRsaKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAPublicKey\"}),\" publicKey \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAPublicKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" keyPair\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getPublic\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAPrivateKey\"}),\" privateKey \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"RSAPrivateKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" keyPair\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getPrivate\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(a.span,{className:\"token class-name\",children:[\"RSAKey\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"Builder\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"publicKey\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"privateKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"privateKey\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"keyID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"UUID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"randomUUID\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"toString\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyGeneratorUtils\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyGeneratorUtils\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPair\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"generateRsaKey\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPair\"}),\" keyPair\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPairGenerator\"}),\" keyPairGenerator \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"KeyPairGenerator\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getInstance\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"RSA\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      keyPairGenerator\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"initialize\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"2048\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      keyPair \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" keyPairGenerator\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"generateKeyPair\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" ex\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throw\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"IllegalStateException\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"ex\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" keyPair\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:\"\\u8BF7\\u6CE8\\u610F\"}),\"\\u5728\\u521B\\u5EFA\",(0,n.jsx)(a.em,{children:\"RegisteredClient\"}),\"\\u6CE8\\u518C\\u5BA2\\u6237\\u7AEF\\u7C7B\\u4E2D\\uFF0C1.\\u6211\\u4EEC\\u6CA1\\u6709\\u5B9A\\u4E49\",(0,n.jsx)(a.code,{children:\"client_secret\"}),\";2.\\u5BA2\\u6237\\u7AEF\\u8BA4\\u8BC1\\u6A21\\u5F0F\\u6307\\u5B9A\\u4E3Anone\\uFF1B3.requireProofKey()\\u8BBE\\u7F6E\\u4E3Atrue\\uFF0C\\u6B64\\u5BA2\\u6237\\u7AEF\\u4EC5\\u652F\\u6301PKCE\\u3002\"]}),(0,n.jsxs)(a.p,{children:[\"\\u5176\\u4F59\\u914D\\u7F6E\\u6211\\u8FD9\\u91CC\\u5C31\\u4E0D\\u4E00\\u4E00\\u8BF4\\u660E\\uFF0C\\u53EF\\u4EE5\\u53C2\\u8003\",(0,n.jsx)(a.a,{href:\"https://relive27.github.io/blog/spring-security-oauth2-jwt\",children:\"\\u4E4B\\u524D\\u6587\\u7AE0\"}),\"\\u3002\"]}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(a.p,{children:\"\\u63A5\\u4E0B\\u6765\\uFF0C\\u6211\\u4EEC\\u521B\\u5EFA\\u4E00\\u4E2ASpring Security\\u7684\\u914D\\u7F6E\\u7C7B\\uFF0C\\u6307\\u5B9AForm\\u8868\\u5355\\u8BA4\\u8BC1\\u548C\\u8BBE\\u7F6E\\u7528\\u6237\\u540D\\u5BC6\\u7801\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Configuration\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityConfig\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityFilterChain\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"defaultSecurityFilterChain\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HttpSecurity\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`        http\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizeRequests\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizeRequests \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        authorizeRequests\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"anyRequest\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authenticated\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"formLogin\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"withDefaults\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UserDetailsService\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"users\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"UserDetails\"}),\" user \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"User\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"withDefaultPasswordEncoder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"username\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"admin\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"password\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"password\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"roles\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"USER\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"InMemoryUserDetailsManager\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"user\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"PasswordEncoder\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"passwordEncoder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"PasswordEncoderFactories\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"createDelegatingPasswordEncoder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsx)(a.p,{children:\"\\u81F3\\u6B64\\u6211\\u4EEC\\u5C31\\u5DF2\\u7ECF\\u914D\\u7F6E\\u597D\\u4E86\\u4E00\\u4E2A\\u7B80\\u5355\\u7684\\u6388\\u6743\\u670D\\u52A1\\u5668\\u3002\"}),(0,n.jsxs)(a.h3,{id:\"oauth2\\u5BA2\\u6237\\u7AEF\",children:[(0,n.jsx)(a.a,{href:\"#oauth2\\u5BA2\\u6237\\u7AEF\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"OAuth2\\u5BA2\\u6237\\u7AEF\"]}),(0,n.jsxs)(a.p,{children:[\"\\u672C\\u8282\\u4E2D\\u6211\\u4EEC\\u4F7F\\u7528\",(0,n.jsx)(a.a,{href:\"https://docs.spring.io/spring-security/reference/servlet/oauth2/client/index.html\",children:\"Spring Security\"}),\"\\u521B\\u5EFA\\u4E00\\u4E2A\\u5BA2\\u6237\\u7AEF\\uFF0C\\u6B64\\u5BA2\\u6237\\u7AEF\\u901A\\u8FC7PKCE\\u6388\\u6743\\u7801\\u6D41\\u5411\\u6388\\u6743\\u670D\\u52A1\\u5668\\u8BF7\\u6C42\\u6388\\u6743\\uFF0C\\u5E76\\u5C06\\u83B7\\u53D6\\u7684access_token\\u53D1\\u9001\\u5230\\u8D44\\u6E90\\u670D\\u52A1\\u3002\"]}),(0,n.jsxs)(a.h4,{id:\"maven-1\",children:[(0,n.jsx)(a.a,{href:\"#maven-1\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"maven\"]}),(0,n.jsx)(a.pre,{className:\"language-xml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-xml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-web\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-security\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-oauth2-client\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-webflux\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"5.3.9\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"io.projectreactor.netty\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"reactor-netty\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"1.0.9\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsxs)(a.h4,{id:\"\\u914D\\u7F6E-1\",children:[(0,n.jsx)(a.a,{href:\"#\\u914D\\u7F6E-1\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u914D\\u7F6E\"]}),(0,n.jsx)(a.p,{children:\"\\u9996\\u5148\\u6211\\u4EEC\\u5C06\\u5728application.yml\\u4E2D\\u914D\\u7F6E\\u5BA2\\u6237\\u7AEF\\u4FE1\\u606F\\uFF0C\\u5E76\\u6307\\u5B9A\\u670D\\u52A1\\u7AEF\\u53E3\\u53F7\\u4E3A8070\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-yaml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"port\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"8070\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"servlet\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"session\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"cookie\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" CLIENT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`SESSION\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"spring\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"security\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"oauth2\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"client\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"registration\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"messaging-client-pkce\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"provider\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" client\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`provider\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"client-id\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" relive\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"client-secret\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" relive\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"authorization-grant-type\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` authorization_code\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"client-authentication-method\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` none\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"redirect-uri\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"http://127.0.0.1:8070/login/oauth2/code/{registrationId}\"'}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"scope\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` message.read\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"client-name\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" messaging\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`pkce\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"provider\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"client-provider\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"authorization-uri\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//127.0.0.1\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8080/oauth2/authorize\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"token-uri\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//127.0.0.1\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8080/oauth2/token\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(a.p,{children:\"\\u63A5\\u4E0B\\u6765\\uFF0C\\u6211\\u4EEC\\u521B\\u5EFASpring Security\\u914D\\u7F6E\\u7C7B\\uFF0C\\u542F\\u7528OAuth2\\u5BA2\\u6237\\u7AEF\\u3002\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Configuration\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityConfig\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityFilterChain\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"securityFilterChain\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HttpSecurity\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`        http\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizeRequests\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizeRequests \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"//\\u4FBF\\u4E8E\\u6D4B\\u8BD5\\uFF0C\\u5C06\\u6743\\u9650\\u5F00\\u653E\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        authorizeRequests\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"anyRequest\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"permitAll\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"oauth2Client\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"withDefaults\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"WebClient\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"webClient\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClientManager\"}),\" authorizedClientManager\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ServletOAuth2AuthorizedClientExchangeFilterFunction\"}),\" oauth2Client \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ServletOAuth2AuthorizedClientExchangeFilterFunction\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizedClientManager\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"WebClient\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"builder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"filter\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"oauth2Client\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClientManager\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizedClientManager\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ClientRegistrationRepository\"}),\" clientRegistrationRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                                                          \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClientRepository\"}),\" authorizedClientRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClientProvider\"}),\" authorizedClientProvider \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClientProviderBuilder\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"builder\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizationCode\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"refreshToken\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"DefaultOAuth2AuthorizedClientManager\"}),\" authorizedClientManager \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"DefaultOAuth2AuthorizedClientManager\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"clientRegistrationRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" authorizedClientRepository\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        authorizedClientManager\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"setAuthorizedClientProvider\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizedClientProvider\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" authorizedClientManager\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`})]})}),(0,n.jsxs)(a.p,{children:[\"\\u4E0A\\u8FF0\\u914D\\u7F6E\\u7C7B\\u4E2D\\u6211\\u4EEC\\u901A\\u8FC7\",(0,n.jsxs)(a.em,{children:[\"oauth2Client(withDefaults())\",(0,n.jsxs)(a.em,{children:[\"\\u542F\\u7528OAuth2\\u5BA2\\u6237\\u7AEF\\u3002\\u5E76\\u521B\\u5EFA\\u4E00\\u4E2AWebClient\\u5B9E\\u4F8B\\u7528\\u4E8E\\u5411\\u8D44\\u6E90\\u670D\\u52A1\\u5668\\u6267\\u884CHTTP\\u8BF7\\u6C42\\u3002\",(0,n.jsx)(a.code,{children:\"OAuth2AuthorizedClientManager\"}),\"\\u8FD9\\u662F\\u534F\\u8C03OAuth2\\u6388\\u6743\\u7801\\u8BF7\\u6C42\\u7684\\u9AD8\\u7EA7\\u63A7\\u5236\\u5668\\u7C7B\\uFF0C\\u4E0D\\u8FC7\\u6388\\u6743\\u7801\\u6D41\\u7A0B\\u5E76\\u4E0D\\u662F\\u7531\\u5B83\\u63A7\\u5236\\uFF0C\\u53EF\\u4EE5\\u67E5\\u770B\\u5B83\\u6240\\u7BA1\\u7406\\u7684\"]}),\"Provider\"]}),\"\\u5B9E\\u73B0\\u7C7B\",(0,n.jsx)(a.em,{children:\"AuthorizationCodeOAuth2AuthorizedClientProvider\"}),\"\\u4E2D\\u5E76\\u6CA1\\u6709\\u6D89\\u53CA\\u76F8\\u5173\\u6388\\u6743\\u7801\\u6D41\\u7A0B\\u4EE3\\u7801\\u903B\\u8F91\\uFF0C\\u5BF9\\u4E8ESpring Security\\u6388\\u6743\\u7801\\u6A21\\u5F0F\\u6D89\\u53CA\\u6838\\u5FC3\\u63A5\\u53E3\\u6D41\\u7A0B\\u6211\\u4F1A\\u653E\\u5728\\u4E4B\\u540E\\u7684\\u6587\\u7AE0\\u7EDF\\u4E00\\u4ECB\\u7ECD\\u3002\\u56DE\\u5230\",(0,n.jsx)(a.em,{children:\"OAuth2AuthorizedClientManager\"}),\"\\u7C7B\\u4E2D\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u770B\\u5230\\u540C\\u65F6\\u8FD8\\u6307\\u5B9A\\u4E86\",(0,n.jsx)(a.em,{children:\"refreshToken()\"}),\",\\u5B83\\u5B9E\\u73B0\\u4E86\\u5237\\u65B0token\\u903B\\u8F91\\uFF0C\\u5C06\\u5728\\u8BF7\\u6C42\\u8D44\\u6E90\\u670D\\u52A1\\u8FC7\\u7A0B\\u4E2Daccess_token\\u8FC7\\u671F\\u540E\\u5C06\\u5237\\u65B0token\\uFF0C\\u524D\\u63D0\\u662Frefresh_token\\u6CA1\\u6709\\u8FC7\\u671F\\uFF0C\\u5426\\u5219\\u4F60\\u5C06\\u91CD\\u65B0\\u6267\\u884COAuth2\\u6388\\u6743\\u7801\\u6D41\\u7A0B\\u3002\"]}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(a.p,{children:\"\\u63A5\\u4E0B\\u6765\\uFF0C\\u6211\\u4EEC\\u521B\\u5EFA\\u4E00\\u4E2AController\\u7C7B\\uFF0C\\u4F7F\\u7528WebClient\\u8BF7\\u6C42\\u8D44\\u6E90\\u670D\\u52A1\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@RestController\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"PkceClientController\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Autowired\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"WebClient\"}),\" webClient\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@GetMapping\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"value \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"/client/test\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"getArticles\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@RegisteredOAuth2AuthorizedClient\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"messaging-client-pkce\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2AuthorizedClient\"}),\" authorizedClient\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),`webClient\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"uri\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"http://127.0.0.1:8090/resource/article\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"attributes\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"oauth2AuthorizedClient\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorizedClient\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"retrieve\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"bodyToMono\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"block\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.h3,{id:\"\\u8D44\\u6E90\\u670D\\u52A1\\u5668\",children:[(0,n.jsx)(a.a,{href:\"#\\u8D44\\u6E90\\u670D\\u52A1\\u5668\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u8D44\\u6E90\\u670D\\u52A1\\u5668\"]}),(0,n.jsx)(a.p,{children:\"\\u672C\\u8282\\u4E2D\\uFF0C\\u6211\\u4EEC\\u5C06\\u4F7F\\u7528Spring Security\\u642D\\u5EFA\\u4E00\\u4E2A\\u8D44\\u6E90\\u670D\\u52A1\\u5668\\u3002\"}),(0,n.jsxs)(a.h3,{id:\"maven-2\",children:[(0,n.jsx)(a.a,{href:\"#maven-2\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"maven\"]}),(0,n.jsx)(a.pre,{className:\"language-xml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-xml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-web\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-security\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.boot\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-boot-starter-oauth2-resource-server\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"2.6.7\",(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"version\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsxs)(a.span,{className:\"token tag\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})]})}),(0,n.jsxs)(a.h4,{id:\"\\u914D\\u7F6E-2\",children:[(0,n.jsx)(a.a,{href:\"#\\u914D\\u7F6E-2\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u914D\\u7F6E\"]}),(0,n.jsx)(a.p,{children:\"\\u901A\\u8FC7application.yml\\u914D\\u7F6E\\u8D44\\u6E90\\u670D\\u52A1\\u5668\\u670D\\u52A1\\u7AEF\\u53E38070\\uFF0C\\u5E76\\u6307\\u5B9A\\u6388\\u6743\\u670D\\u52A1\\u5668jwk uri\\uFF0C\\u7528\\u4E8E\\u83B7\\u53D6\\u516C\\u94A5\\u4FE1\\u606F\\u9A8C\\u8BC1token\\u4EE4\\u724C\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-yaml\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"port\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"8090\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"spring\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"security\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"oauth2\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"resourceserver\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"jwt\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(a.span,{className:\"token atrule key\",children:\"jwk-set-uri\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//127.0.0.1\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8080/oauth2/jwks\n`]})]})}),(0,n.jsx)(a.p,{children:\"\\u63A5\\u4E0B\\u6765\\u914D\\u7F6ESpring Security\\u914D\\u7F6E\\u7C7B\\uFF0C\\u6307\\u5B9A\\u53D7\\u4FDD\\u62A4\\u7AEF\\u70B9\\u8BBF\\u95EE\\u6743\\u9650\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Configuration\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityConfig\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"SecurityFilterChain\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"defaultSecurityFilter\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"HttpSecurity\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"requestMatchers\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"antMatchers\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"/resource/article\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"and\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"authorizeHttpRequests\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"authorize\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\u003e\"}),` authorize\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"antMatchers\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"/resource/article\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"hasAuthority\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"SCOPE_message.read\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"mvcMatchers\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"oauth2ResourceServer\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"OAuth2ResourceServerConfigurer\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"::\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"jwt\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" http\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(a.p,{children:\"\\u4E0A\\u8FF0\\u914D\\u7F6E\\u7C7B\\u4E2D\\u6307\\u5B9A/resource/article\\u5FC5\\u987B\\u62E5\\u6709message.read\\u6743\\u9650\\u624D\\u80FD\\u8BBF\\u95EE\\uFF0C\\u5E76\\u914D\\u7F6E\\u8D44\\u6E90\\u670D\\u52A1\\u4F7F\\u7528JWT\\u8EAB\\u4EFD\\u9A8C\\u8BC1\\u3002\"}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(a.p,{children:\"\\u4E4B\\u540E\\u6211\\u4EEC\\u5C06\\u521B\\u5EFAController\\u7C7B\\uFF0C\\u4F5C\\u4E3A\\u53D7\\u4FDD\\u62A4\\u7AEF\\u70B9\\uFF1A\"}),(0,n.jsx)(a.pre,{className:\"language-java\",children:(0,n.jsxs)(a.code,{className:\"code-highlight language-java\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@RestController\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"ArticleRestController\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation annotation\",children:\"@GetMapping\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"/resource/article\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsxs)(a.span,{className:\"token generics\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(a.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"article\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(a.span,{className:\"token class-name\",children:\"Arrays\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"asList\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"article1\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"article2\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"article3\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(a.h3,{id:\"\\u8BBF\\u95EE\\u8D44\\u6E90\\u5217\\u8868\",children:[(0,n.jsx)(a.a,{href:\"#\\u8BBF\\u95EE\\u8D44\\u6E90\\u5217\\u8868\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u8BBF\\u95EE\\u8D44\\u6E90\\u5217\\u8868\"]}),(0,n.jsxs)(a.p,{children:[\"\\u542F\\u52A8\\u6240\\u6709\\u670D\\u52A1\\u540E\\uFF0C\\u5728\\u6D4F\\u89C8\\u5668\\u4E2D\\u8F93\\u5165 \",(0,n.jsx)(a.a,{href:\"http://127.0.0.1:8070/client/test\",children:\"http://127.0.0.1:8070/client/test\"}),\" \\uFF0C\\u901A\\u8FC7\\u6388\\u6743\\u670D\\u52A1\\u5668\\u8BA4\\u8BC1\\u540E\\uFF0C\\u60A8\\u5C06\\u5728\\u9875\\u9762\\u4E2D\\u770B\\u5230\\u4EE5\\u4E0B\\u8F93\\u51FA\\u4FE1\\u606F\\uFF1A\"]}),(0,n.jsx)(a.pre,{className:\"language-json\",children:(0,n.jsx)(a.code,{className:\"code-highlight language-json\",children:(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"article1\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"article2\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'\"article3\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})})}),(0,n.jsxs)(a.h3,{id:\"\\u7ED3\\u8BBA\",children:[(0,n.jsx)(a.a,{href:\"#\\u7ED3\\u8BBA\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\u7ED3\\u8BBA\"]}),(0,n.jsx)(a.p,{children:\"\\u5728Spring Security\\u76EE\\u524D\\u7248\\u672C\\u4E2D\\u4FDD\\u5BC6\\u5BA2\\u6237\\u7AEF\\u7684 PKCE \\u5DF2\\u7ECF\\u6210\\u4E3A\\u9ED8\\u8BA4\\u884C\\u4E3A\\u3002\\u5728\\u4FDD\\u5BC6\\u5BA2\\u6237\\u7AEF\\u6388\\u6743\\u7801\\u6A21\\u5F0F\\u4E2D\\u540C\\u6837\\u53EF\\u4EE5\\u4F7F\\u7528PKCE\\u3002\"}),(0,n.jsxs)(a.p,{children:[\"\\u4E0E\\u5F80\\u5E38\\u4E00\\u6837\\uFF0C\\u672C\\u6587\\u4E2D\\u4F7F\\u7528\\u7684\\u6E90\\u4EE3\\u7801\\u53EF\",(0,n.jsx)(a.a,{href:\"https://github.com/ReLive27/spring-security-oauth2-sample/tree/main/oauth2-pkce\",children:\"\\u5728 GitHub \\u4E0A\"}),\"\\u83B7\\u5F97\\u3002\"]})]})}}var w=f;return b;})();\n;return Component;","toc":[{"value":"Spring Security OAuth2 带有用于代码交换的证明密钥 (PKCE) 的授权码流","url":"#spring-security-oauth2-带有用于代码交换的证明密钥-pkce-的授权码流","depth":2},{"value":"概述","url":"#概述","depth":3},{"value":"Proof Key for Code Exchange","url":"#proof-key-for-code-exchange","depth":3},{"value":"使用Spring Authorization Server搭建授权服务器","url":"#使用spring-authorization-server搭建授权服务器","depth":3},{"value":"maven","url":"#maven","depth":4},{"value":"配置","url":"#配置","depth":4},{"value":"OAuth2客户端","url":"#oauth2客户端","depth":3},{"value":"maven","url":"#maven","depth":4},{"value":"配置","url":"#配置","depth":4},{"value":"资源服务器","url":"#资源服务器","depth":3},{"value":"maven","url":"#maven","depth":3},{"value":"配置","url":"#配置","depth":4},{"value":"访问资源列表","url":"#访问资源列表","depth":3},{"value":"结论","url":"#结论","depth":3}],"frontMatter":{"readingTime":{"text":"11 min read","minutes":10.265,"time":615900,"words":2053},"slug":"oauth2-pkce","fileName":"oauth2-pkce.mdx","title":"Spring Security OAuth2 带有用于代码交换的证明密钥 (PKCE) 的授权码流","date":"2022-07-17T12:21:50.000Z","tags":["OAuth2","SpringSecurity"],"draft":false,"authors":["default"]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.18,"time":10800,"words":36},"slug":["default"],"fileName":"default.md","name":"ReLive27","avatar":"../static/images/avatar.png","occupation":"中级软件工程师","date":null}],"prev":{"title":"Spring Security OAuth2客户端凭据授权","date":"2022-07-09T18:22:26.000Z","tags":["SpringSecurity","OAuth2"],"draft":false,"authors":["default"],"slug":"oauth2-client-model"},"next":{"title":"Spring Security OAuth2登录","date":"2022-07-25T20:01:01.000Z","tags":["OAuth2","SpringSecurity"],"draft":false,"authors":["default"],"slug":"oauth2-login"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["oauth2-pkce"]},"buildId":"ncYKBo26SAMSsuoTiRfZ4","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>